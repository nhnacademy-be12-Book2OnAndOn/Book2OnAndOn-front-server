<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<th:block th:fragment="sliderSection(sliderId, books, badgeText)">
    <div class="book-slider"
         th:id="${sliderId}"
         th:with="list=${books}, total=${list != null ? #lists.size(list) : 0}, sliceCount=${total > 0 ? (total + 4) / 5 : 0}"
         th:if="${list != null and !list.isEmpty()}">
        <button class="slider-btn slider-prev" type="button" aria-label="이전 도서">‹</button>
        <div class="slider-viewport">
            <div class="slider-track" th:if="${total > 0}">
                <th:block th:each="slice : ${#numbers.sequence(0, sliceCount - 1)}"
                          th:with="start=${slice * 5}, end=${T(java.lang.Math).min((slice + 1) * 5 - 1, total - 1)}">
                    <div class="book-slide">
                        <div class="book-grid slice-grid">
                            <div class="book-card" th:each="i : ${#numbers.sequence(start, end)}" th:with="book=${list[i]}">
                                <span class="book-badge" th:text="${badgeText}" style="background-color: #7950f2; color: white;">TAG</span>
                                <a class="book-cover" th:href="@{/books/{id}(id=${book.id})}">
                                    <img class="book-image" th:alt="${book.title}" th:if="${book.thumbnail != null}" th:src="${book.thumbnail}">
                                    <div class="thumb-fallback" th:unless="${book.thumbnail != null}">표지 준비중</div>
                                </a>
                                <div class="book-details">
                                    <a class="no-deco" th:href="@{/books/{id}(id=${book.id})}">
                                        <p class="book-title" th:text="${book.title}">제목</p>
                                    </a>
                                    <p class="book-author" th:text="${book.contributorNames != null and !book.contributorNames.isEmpty()} ? ${book.contributorNames[0]} : '저자 정보 없음'">저자</p>
                                    <div class="book-meta">
                                        <div class="rating"><span>★</span> <span th:text="${book.rating}">0.0</span></div>
                                        <div class="price-info">
                                            <span class="price" th:text="${book.priceSales != null} ? '₩' + ${#numbers.formatInteger(book.priceSales, 0, 'COMMA')} : '가격미정'">₩0</span>
                                        </div>
                                        <button class="like-btn" th:classappend="${book.likedByCurrentUser} ? 'active' : ''" th:onclick="'toggleLike(this, ' + ${book.id} + ')'" type="button">
                                            <span class="heart-icon"></span>
                                            <span class="like-count" th:text="${book.likeCount}">0</span>
                                        </button>
                                    </div>
                                </div>
                                <button class="cart-button" th:onclick="'addToCart(' + ${book.id} + ')'"><span>장바구니</span></button>
                            </div>
                        </div>
                    </div>
                </th:block>
            </div>
        </div>
        <button class="slider-btn slider-next" type="button" aria-label="다음 도서">›</button>
    </div>
</th:block>
</body>
</html>
