<!DOCTYPE html>
<html lang="ko"
      layout:decorate="~{layout/mypage-layout}"
      th:with="sidebarActive='orders'"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title layout:fragment="title">주문 상세</title>
    <th:block layout:fragment="extraHead">
        <link rel="stylesheet" th:href="@{/css/OrderHistory.css}">
        <style>
            .order-detail-shell {
                background: linear-gradient(180deg, #ffffff 0%, #f8fbf8 100%);
                border: 1px solid #e3eadf;
                border-radius: 22px;
                padding: 22px 24px 26px;
                box-shadow: 0 18px 40px rgba(15, 40, 24, 0.08);
                display: flex;
                flex-direction: column;
                gap: 16px;
            }

            .order-header-grid {
                display: grid;
                grid-template-columns: 1fr auto;
                gap: 12px;
                align-items: start;
            }
            .order-header-left h2 {
                margin: 0 0 4px;
                color: #1f3a2c;
                font-size: 1.3rem;
                font-weight: 800;
            }
            .order-header-meta {
                display: flex;
                gap: 10px;
                align-items: center;
                color: #516557;
                font-weight: 700;
            }
            .status-chip {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                background: #eef5ef;
                color: #1f4a30;
                padding: 10px 14px;
                border-radius: 999px;
                font-weight: 800;
                letter-spacing: 0.02em;
                border: 1px solid #d0dfd2;
                box-shadow: 0 8px 18px rgba(47, 98, 66, 0.15);
            }

            .info-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
                gap: 14px;
            }

            .info-card {
                background: #f9fbf8;
                border: 1px solid #d9e3d6;
                border-radius: 12px;
                padding: 12px 14px;
            }

            .info-card h4 {
                margin: 0 0 10px;
                color: #1f3a2c;
                font-size: 1rem;
                font-weight: 800;
            }

            .items-table {
                border: 1px solid #d9e3d6;
                border-radius: 14px;
                overflow: hidden;
                background: #ffffff;
                box-shadow: inset 0 1px 0 #eff3ef;
            }
            .items-table table {
                width: 100%;
                border-collapse: collapse;
            }
            .items-table th,
            .items-table td {
                padding: 12px 14px;
                text-align: left;
            }
            .items-table th {
                background: #f3f7f3;
                color: #1f3a2c;
                font-weight: 800;
            }
            .items-table tr + tr td {
                border-top: 1px solid #eff3ef;
            }

            .totals {
                text-align: right;
                font-weight: 800;
                color: #1f3a2c;
                padding: 8px 4px;
            }

            .meta-line {
                display: flex;
                gap: 8px;
                align-items: center;
                color: #4f6658;
            }

            .muted {
                color: #607463;
                font-weight: 600;
            }

            .actions-row {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                justify-content: flex-start;
            }
            .btn-secondary {
                background: #eef2ed;
                color: #234132;
                border: 1px solid #d6dfd4;
                padding: 10px 16px;
                border-radius: 12px;
                font-weight: 800;
                box-shadow: 0 8px 18px rgba(0,0,0,0.05);
            }
            .btn-primary {
                background: #2f6242;
                color: #fff;
                border: none;
                padding: 10px 18px;
                border-radius: 12px;
                font-weight: 800;
                box-shadow: 0 12px 22px rgba(47, 98, 66, 0.2);
            }
            .summary-card {
                display: flex;
                flex-direction: column;
                gap: 6px;
                background: #f7fbf7;
                border: 1px solid #dce6db;
                border-radius: 12px;
                padding: 12px 14px;
                min-width: 240px;
                box-shadow: inset 0 1px 0 #eef3ee;
            }
        </style>
    </th:block>
</head>
<body>
<div class="mypage-content order-detail-shell" layout:fragment="content">
    <div class="order-header-grid">
        <div class="order-header-left">
            <h2>주문 상세</h2>
            <div class="order-header-meta">
                <span th:text="${order.orderDatetime != null ? #temporals.format(order.orderDatetime, 'yyyy-MM-dd HH:mm') : ''}">2025-01-01 12:00</span>
                <span>·</span>
                <span th:text="${order.orderNumber}">B2-000000000001</span>
            </div>
        </div>
        <span class="status-chip" th:text="${order.orderStatus != null ? order.orderStatus : '상태 미정'}">상태</span>
    </div>

    <div class="info-grid">
        <div class="info-card">
            <h4>수령 정보</h4>
            <div th:text="${order.deliveryAddress != null ? order.deliveryAddress.recipient() : '-'}">수령인</div>
            <div class="muted" th:text="${order.deliveryAddress != null ? order.deliveryAddress.deliveryAddress() : '-'}">주소</div>
            <div class="muted" th:text="${order.deliveryAddress != null ? order.deliveryAddress.deliveryAddressDetail() : '-'}">상세주소</div>
            <div class="muted" th:text="${order.deliveryAddress != null ? order.deliveryAddress.recipientPhoneNumber() : '-'}">연락처</div>
            <div class="muted" th:text="${order.deliveryAddress != null ? order.deliveryAddress.deliveryMessage() : ''}">배송 메모</div>
        </div>
        <div class="info-card">
            <h4>배송</h4>
            <div>택배사: <span class="muted">등록 대기</span></div>
            <div>운송장: <span class="muted">등록 대기</span></div>
            <div th:text="${order.wantDeliveryDate != null ? order.wantDeliveryDate : '-'}">희망 배송일</div>
        </div>
        <div class="info-card">
            <h4>결제 요약</h4>
            <div class="summary-card wide">
                <div>상품 합계: <strong
                        th:text="${order.totalItemAmount != null ? #numbers.formatInteger(order.totalItemAmount, 0, 'COMMA') + '원' : '-'}">0원</strong>
                </div>
                <div>배송비: <span
                        th:text="${order.deliveryFee != null ? #numbers.formatInteger(order.deliveryFee, 0, 'COMMA') + '원' : '-'}">0원</span>
                </div>
                <div>할인: <span
                        th:text="${order.totalDiscountAmount != null ? #numbers.formatInteger(order.totalDiscountAmount, 0, 'COMMA') + '원' : '0원'}">0원</span>
                </div>
                <div style="margin-top:6px;">총 결제: <strong
                        th:text="${order.totalAmount != null ? #numbers.formatInteger(order.totalAmount, 0, 'COMMA') + '원' : '-'}">0원</strong>
                </div>
            </div>
        </div>
    </div>

    <div class="items-table" th:if="${order.orderItems != null}">
        <table>
            <thead>
            <tr>
                <th>상품명</th>
                <th style="width:120px;">수량</th>
                <th style="width:160px;">금액</th>
                <th style="width:160px;" th:if="${order.orderStatus == '배송 완료'}">리뷰</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item : ${order.orderItems}">
                <td>
                    <div th:text="${item.bookTitle}">도서명</div>
                    <div class="muted" th:if="${item.wrappingPaperId != null}">포장 옵션 포함</div>
                </td>
                <td th:text="${item.orderItemQuantity}">1</td>
                <td th:text="${item.unitPrice != null ? #numbers.formatInteger(item.unitPrice, 0, 'COMMA') + '원' : '-'}">0원</td>
                <td th:if="${order.orderStatus == '배송 완료'}">
                    <a class="btn-secondary" th:href="@{'/books/' + ${item.bookId} + '?tab=reviews'}">리뷰 작성</a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="totals">
        결제 금액: <span
            th:text="${order.totalAmount != null ? #numbers.formatInteger(order.totalAmount, 0, 'COMMA') + '원' : '-'}">0원</span>
    </div>

    <div class="actions-row">
        <a class="btn-secondary" th:href="@{/users/me/orders}">목록으로</a>
        <a class="btn-primary" style="text-decoration:none;"
           th:href="@{/refunds/orders/{orderId}/form(orderId=${order.orderId})}" th:if="${order.orderId != null}">반품</a>
<!--        th:href="@{'/orders/' + ${order.orderNumber} + '/cancel'}" th:if="${order.orderNumber != null}">취소/문의</a>-->
    </div>
</div>
</body>
</html>
