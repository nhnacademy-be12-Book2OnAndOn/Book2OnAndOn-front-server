<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì£¼ë¬¸ ë‚´ì—­ í™•ì¸ - Book2OnAndOn</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      background: #4A7C59;
      color: white;
      padding: 25px 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(74, 124, 89, 0.3);
      margin-bottom: 30px;
    }

    header h1 {
      font-size: 1.8em;
      margin-bottom: 5px;
    }

    header p {
      opacity: 0.9;
      font-size: 0.95em;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .card h2 {
      color: #4A7C59;
      margin-bottom: 20px;
      font-size: 1.4em;
      border-bottom: 3px solid #4A7C59;
      padding-bottom: 10px;
    }

    .card p {
      color: #666;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
      transition: all 0.3s;
    }

    .form-group input:focus {
      outline: none;
      border-color: #4A7C59;
      box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.1);
    }

    .btn {
      background: #4A7C59;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    .btn:hover {
      background: #3d6549;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(74, 124, 89, 0.3);
    }

    .btn-secondary {
      background: #6c757d;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn-sm {
      padding: 8px 20px;
      font-size: 0.9em;
      width: auto;
    }

    .btn-danger {
      background: #dc3545;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .order-list {
      display: grid;
      gap: 20px;
    }

    .order-item {
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 25px;
      transition: all 0.3s ease;
      background: #fafafa;
      cursor: pointer;
    }

    .order-item:hover {
      border-color: #4A7C59;
      box-shadow: 0 5px 20px rgba(74, 124, 89, 0.15);
      transform: translateY(-2px);
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e0e0e0;
    }

    .order-number {
      font-size: 1.2em;
      font-weight: bold;
      color: #4A7C59;
    }

    .order-date {
      color: #666;
      font-size: 0.9em;
      margin-top: 5px;
    }

    .status-badge {
      display: inline-block;
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 600;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-shipping {
      background: #d1ecf1;
      color: #0c5460;
    }

    .status-delivered {
      background: #d4edda;
      color: #155724;
    }

    .status-canceled {
      background: #f8d7da;
      color: #721c24;
    }

    .status-return {
      background: #fff3cd;
      color: #856404;
    }

    .order-body {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    .info-item {
      display: flex;
      flex-direction: column;
    }

    .info-label {
      font-size: 0.85em;
      color: #666;
      margin-bottom: 5px;
    }

    .info-value {
      font-weight: 600;
      color: #333;
    }

    .order-detail-content {
      line-height: 1.8;
    }

    .order-detail-content h3 {
      color: #4A7C59;
      margin-top: 25px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e9ecef;
    }

    .order-detail-content h3:first-child {
      margin-top: 0;
    }

    .detail-row {
      display: flex;
      padding: 12px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .detail-row:last-child {
      border-bottom: none;
    }

    .detail-label {
      width: 150px;
      font-weight: 600;
      color: #666;
    }

    .detail-value {
      flex: 1;
      color: #333;
    }

    .item-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid #4A7C59;
    }

    .item-name {
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }

    .item-info {
      font-size: 0.9em;
      color: #666;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: flex-end;
    }

    .total-amount {
      background: #f0f8f4;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
      text-align: right;
    }

    .total-amount h3 {
      color: #4A7C59;
      font-size: 1.5em;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .empty-state-icon {
      font-size: 4em;
      margin-bottom: 20px;
      opacity: 0.3;
    }

    .empty-state h3 {
      font-size: 1.3em;
      margin-bottom: 10px;
      color: #333;
    }

    .link {
      color: #4A7C59;
      text-decoration: none;
      font-weight: 600;
    }

    .link:hover {
      text-decoration: underline;
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 768px) {
      .order-body {
        grid-template-columns: 1fr;
      }

      .action-buttons {
        flex-direction: column;
      }

      .btn-sm {
        width: 100%;
      }

      .detail-row {
        flex-direction: column;
      }

      .detail-label {
        width: 100%;
        margin-bottom: 5px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>ğŸ“¦ ì£¼ë¬¸ ë‚´ì—­ í™•ì¸</h1>
    <p>Book2OnAndOnì—ì„œ ì£¼ë¬¸í•˜ì‹  ë‚´ì—­ì„ í™•ì¸í•˜ì„¸ìš”</p>
  </header>

  <!-- ë¹„íšŒì› ì£¼ë¬¸ ì¡°íšŒ ì„¹ì…˜ -->
  <section id="guestLookupSection" class="hidden">
    <div class="card">
      <h2>ë¹„íšŒì› ì£¼ë¬¸ ì¡°íšŒ</h2>
      <p>ì£¼ë¬¸ ì‹œ ì…ë ¥í–ˆë˜ ì •ë³´ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <form id="guestLookupForm">
        <div class="form-group">
          <input type="text" id="guestOrderId" placeholder="ì£¼ë¬¸ ë²ˆí˜¸" required>
        </div>
        <div class="form-group">
          <input type="text" id="guestOrderer" placeholder="ì£¼ë¬¸ì ì´ë¦„" required>
        </div>
        <div class="form-group">
          <input type="password" id="guestPassword" placeholder="ì£¼ë¬¸ ë¹„ë°€ë²ˆí˜¸ (ë˜ëŠ” ì—°ë½ì²˜ ë 4ìë¦¬)" required>
        </div>
        <button type="submit" class="btn">ì£¼ë¬¸ ì¡°íšŒ</button>
      </form>
      <p style="margin-top: 20px; text-align: center;">
        í˜¹ì€ <a href="#" id="memberLoginLink" class="link">ë¡œê·¸ì¸</a>í•˜ì—¬ ì „ì²´ ì£¼ë¬¸ ë‚´ì—­ì„ í™•ì¸í•˜ì„¸ìš”.
      </p>
    </div>
  </section>

  <!-- íšŒì› ì£¼ë¬¸ ëª©ë¡ ì„¹ì…˜ -->
  <section id="memberHistorySection" class="hidden">
    <div class="card">
      <h2>ì „ì²´ ì£¼ë¬¸ ë‚´ì—­ (<span id="userNameDisplay">íšŒì›</span>ë‹˜)</h2>
      <div id="orderList" class="order-list">
        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
      </div>
      <div id="noOrdersMessage" class="empty-state hidden">
        <div class="empty-state-icon">ğŸ“­</div>
        <h3>ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
        <p>ì•„ì§ ì£¼ë¬¸í•˜ì‹  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>
    </div>
  </section>

  <!-- ì£¼ë¬¸ ìƒì„¸ ì„¹ì…˜ -->
  <section id="orderDetailSection" class="hidden">
    <div class="card">
      <h2>ì£¼ë¬¸ ìƒì„¸ ì •ë³´</h2>

      <div id="actionButtons" class="action-buttons">
        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
      </div>

      <div id="orderDetailContent" class="order-detail-content">
        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
      </div>

      <button id="backToHistory" class="btn btn-secondary" style="margin-top: 30px; width: auto;">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>
  </section>
</div>

<script>
  const API_BASE = '/orders';
  const USER_ID = 10;
  const IS_MEMBER_LOGGED_IN = true;

  const ORDER_STATUS = {
    PENDING: { text: "ì£¼ë¬¸ ëŒ€ê¸°", class: "status-pending" },
    SHIPPING: { text: "ë°°ì†¡ì¤‘", class: "status-shipping" },
    DELIVERED: { text: "ë°°ì†¡ ì™„ë£Œ", class: "status-delivered" },
    CANCELED: { text: "ì£¼ë¬¸ ì·¨ì†Œ", class: "status-canceled" },
    COMPLETED: { text: "ì£¼ë¬¸ ì™„ë£Œ", class: "status-delivered" },
    RETURN_REQUESTED: { text: "ë°˜í’ˆ ì‹ ì²­", class: "status-return" },
    RETURN_COMPLETED: { text: "ë°˜í’ˆ ì™„ë£Œ", class: "status-canceled" }
  };

  let currentOrderDetail = null;
  let currentMode = 'MEMBER_MODE';

  document.addEventListener('DOMContentLoaded', () => {
    initializeView();
    setupEventListeners();
  });

  function initializeView() {
    const urlParams = new URLSearchParams(window.location.search);
    const orderId = urlParams.get('orderId');
    const mode = urlParams.get('mode');

    const forceGuestMode = mode === 'guest';
    const isLoggedIn = IS_MEMBER_LOGGED_IN && !forceGuestMode;

    if (orderId) {
      fetchOrderDetail(orderId, isLoggedIn ? 'MEMBER_MODE' : 'GUEST_MODE');
    } else if (isLoggedIn) {
      showMemberHistory();
      fetchMemberOrders(USER_ID);
    } else {
      showGuestLookupForm();
    }
  }

  function setupEventListeners() {
    document.getElementById('guestLookupForm')?.addEventListener('submit', handleGuestLookup);
    document.getElementById('backToHistory')?.addEventListener('click', () => {
      if (IS_MEMBER_LOGGED_IN) {
        showMemberHistory();
      } else {
        showGuestLookupForm();
      }
    });
  }

  function hideAllSections() {
    document.getElementById('guestLookupSection').classList.add('hidden');
    document.getElementById('memberHistorySection').classList.add('hidden');
    document.getElementById('orderDetailSection').classList.add('hidden');
  }

  function showGuestLookupForm() {
    hideAllSections();
    document.getElementById('guestLookupSection').classList.remove('hidden');
    currentMode = 'GUEST_MODE';
  }

  function showMemberHistory() {
    hideAllSections();
    document.getElementById('memberHistorySection').classList.remove('hidden');
    currentMode = 'MEMBER_MODE';
  }

  function showOrderDetail() {
    hideAllSections();
    document.getElementById('orderDetailSection').classList.remove('hidden');
  }

  async function fetchMemberOrders(userId) {
    // Mock Data
    const mockOrders = [
      { orderId: 'M1001', date: '2025-12-10', total: 45000, status: 'PENDING', items: [{name: 'í´ë¦° ì½”ë“œ', count: 1}] },
      { orderId: 'M1002', date: '2025-11-20', total: 72000, status: 'DELIVERED', items: [{name: 'ê°ì²´ì§€í–¥ ì„¤ê³„', count: 2}] },
      { orderId: 'M1003', date: '2025-11-01', total: 30000, status: 'SHIPPING', items: [{name: 'ì•Œê³ ë¦¬ì¦˜', count: 1}] },
      { orderId: 'M1004', date: '2025-10-25', total: 50000, status: 'RETURN_REQUESTED', items: [{name: 'ìë°”ì˜ ì •ì„', count: 1}] },
      { orderId: 'M1005', date: '2025-10-20', total: 20000, status: 'CANCELED', items: [{name: 'ì›¹ ê°œë°œ', count: 1}] },
    ];
    renderOrderList(mockOrders);
  }

  function renderOrderList(orders) {
    const listContainer = document.getElementById('orderList');
    listContainer.innerHTML = '';

    if (orders.length === 0) {
      document.getElementById('noOrdersMessage').classList.remove('hidden');
      return;
    }
    document.getElementById('noOrdersMessage').classList.add('hidden');

    orders.forEach(order => {
      const statusInfo = ORDER_STATUS[order.status];
      const orderDiv = document.createElement('div');
      orderDiv.className = 'order-item';
      orderDiv.onclick = () => fetchOrderDetail(order.orderId, 'MEMBER_MODE');

      orderDiv.innerHTML = `
                    <div class="order-header">
                        <div>
                            <div class="order-number">ì£¼ë¬¸ë²ˆí˜¸: ${order.orderId}</div>
                            <div class="order-date">${order.date}</div>
                        </div>
                        <span class="status-badge ${statusInfo.class}">${statusInfo.text}</span>
                    </div>
                    <div class="order-body">
                        <div class="info-item">
                            <span class="info-label">ìƒí’ˆ</span>
                            <span class="info-value">${order.items[0].name} ${order.items.length > 1 ? `ì™¸ ${order.items.length - 1}ê±´` : ''}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ì´ ê¸ˆì•¡</span>
                            <span class="info-value">${order.total.toLocaleString()}ì›</span>
                        </div>
                    </div>
                `;
      listContainer.appendChild(orderDiv);
    });
  }

  async function fetchOrderDetail(orderId, mode) {
    // Mock Detail Data
    const mockDetailMap = {
      'M1001': { id: 'M1001', date: '2025-12-10', total: 45000, status: 'PENDING', recipient: 'í™ê¸¸ë™', address: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬', phone: '010-1234-5678', items: [{ name: 'í´ë¦° ì½”ë“œ', quantity: 1, price: 45000, isWrapped: false }] },
      'M1002': { id: 'M1002', date: '2025-11-20', total: 72000, status: 'DELIVERED', recipient: 'ê¹€ì² ìˆ˜', address: 'ê²½ê¸°ë„ ì„±ë‚¨ì‹œ', phone: '010-2345-6789', items: [{ name: 'ê°ì²´ì§€í–¥ ì„¤ê³„', quantity: 2, price: 36000, isWrapped: true, wrapName: 'ê³ ê¸‰ í¬ì¥' }] },
      'M1003': { id: 'M1003', date: '2025-11-01', total: 30000, status: 'SHIPPING', recipient: 'ì´ì˜í¬', address: 'ë¶€ì‚°ì‹œ í•´ìš´ëŒ€êµ¬', phone: '010-3456-7890', items: [{ name: 'ì•Œê³ ë¦¬ì¦˜', quantity: 1, price: 30000, isWrapped: false }] },
      'M1004': { id: 'M1004', date: '2025-10-25', total: 50000, status: 'RETURN_REQUESTED', recipient: 'ë°•ë¯¼ì¤€', address: 'ëŒ€êµ¬ì‹œ ë‹¬ì„œêµ¬', phone: '010-4567-8901', items: [{ name: 'ìë°”ì˜ ì •ì„', quantity: 1, price: 50000, isWrapped: false }] },
      'M1005': { id: 'M1005', date: '2025-10-20', total: 20000, status: 'CANCELED', recipient: 'ìµœí˜„ìš°', address: 'ì¸ì²œì‹œ ì—°ìˆ˜êµ¬', phone: '010-5678-9012', items: [{ name: 'ì›¹ ê°œë°œ', quantity: 1, price: 20000, isWrapped: false }] },
      'G1001': { id: 'G1001', date: '2025-12-15', total: 55000, status: 'DELIVERED', recipient: 'ë¹„íšŒì›', address: 'ì¸ì²œì‹œ ì—°ìˆ˜êµ¬', phone: '010-9999-9999', items: [{ name: 'ë¦¬ì•¡íŠ¸ ë°”ì´ë¸”', quantity: 1, price: 55000, isWrapped: true, wrapName: 'ì—ì½” í¬ì¥' }] },
    };

    const detail = mockDetailMap[orderId] || mockDetailMap['M1001'];
    currentOrderDetail = detail;
    currentMode = mode;

    renderOrderDetailContent(detail, mode);
    showOrderDetail();
  }

  function renderOrderDetailContent(detail, mode) {
    const detailContainer = document.getElementById('orderDetailContent');
    const statusInfo = ORDER_STATUS[detail.status];

    renderActionButtons(detail);

    const itemsHtml = detail.items.map(item => `
                <div class="item-card">
                    <div class="item-name">${item.name}</div>
                    <div class="item-info">
                        ìˆ˜ëŸ‰: ${item.quantity}ê¶Œ |
                        ë‹¨ê°€: ${item.price.toLocaleString()}ì› |
                        ì†Œê³„: ${(item.price * item.quantity).toLocaleString()}ì›
                        ${item.isWrapped ? ` | í¬ì¥: ${item.wrapName}` : ''}
                    </div>
                </div>
            `).join('');

    detailContainer.innerHTML = `
                <h3>ì£¼ë¬¸ ì •ë³´</h3>
                <div class="detail-row">
                    <span class="detail-label">ì£¼ë¬¸ ë²ˆí˜¸</span>
                    <span class="detail-value"><strong>${detail.id}</strong></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ì£¼ë¬¸ ì¼ì</span>
                    <span class="detail-value">${detail.date}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ì£¼ë¬¸ ìƒíƒœ</span>
                    <span class="detail-value"><span class="status-badge ${statusInfo.class}">${statusInfo.text}</span></span>
                </div>

                <h3>ë°°ì†¡ ì •ë³´</h3>
                <div class="detail-row">
                    <span class="detail-label">ìˆ˜ë ¹ì¸</span>
                    <span class="detail-value">${detail.recipient}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ì—°ë½ì²˜</span>
                    <span class="detail-value">${detail.phone}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ë°°ì†¡ ì£¼ì†Œ</span>
                    <span class="detail-value">${detail.address}</span>
                </div>

                <h3>ì£¼ë¬¸ ìƒí’ˆ</h3>
                ${itemsHtml}

                <div class="total-amount">
                    <h3>ìµœì¢… ê²°ì œ ê¸ˆì•¡: ${detail.total.toLocaleString()}ì›</h3>
                </div>
            `;

    const backButton = document.getElementById('backToHistory');
    if (mode === 'GUEST_MODE') {
      backButton.textContent = 'ë‹¤ë¥¸ ì£¼ë¬¸ ì¡°íšŒí•˜ê¸°';
    } else {
      backButton.textContent = 'ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°';
    }
  }

  function renderActionButtons(detail) {
    const buttonContainer = document.getElementById('actionButtons');
    buttonContainer.innerHTML = '';

    const status = detail.status;

    // ì£¼ë¬¸ ì·¨ì†Œ: PENDING ìƒíƒœì—ì„œë§Œ
    if (status === 'PENDING') {
      const cancelButton = document.createElement('button');
      cancelButton.className = 'btn btn-secondary btn-sm';
      cancelButton.textContent = 'ì£¼ë¬¸ ì·¨ì†Œ';
      cancelButton.onclick = () => handleCancelOrder(detail);
      buttonContainer.appendChild(cancelButton);
    }

    // ë°˜í’ˆ ì‹ ì²­: DELIVERED ìƒíƒœì—ì„œë§Œ
    if (status === 'DELIVERED') {
      const returnButton = document.createElement('button');
      returnButton.className = 'btn btn-sm';
      returnButton.textContent = 'ë°˜í’ˆ ì‹ ì²­';
      returnButton.onclick = () => goToRefundForm(detail);
      buttonContainer.appendChild(returnButton);
    }

    // ë°˜í’ˆ ì·¨ì†Œ: RETURN_REQUESTED ìƒíƒœì—ì„œë§Œ
    if (status === 'RETURN_REQUESTED') {
      const revokeButton = document.createElement('button');
      revokeButton.className = 'btn btn-danger btn-sm';
      revokeButton.textContent = 'ë°˜í’ˆ ì·¨ì†Œ';
      revokeButton.onclick = () => handleRevokeReturn(detail);
      buttonContainer.appendChild(revokeButton);
    }
  }

  function goToRefundForm(detail) {
    // ë°˜í’ˆ ì‹ ì²­ í¼ìœ¼ë¡œ ì´ë™
    const params = new URLSearchParams({
      orderId: detail.id,
      type: currentMode === 'MEMBER_MODE' ? 'member' : 'guest',
      orderNumber: detail.id
    });

    if (currentMode === 'GUEST_MODE') {
      // ë¹„íšŒì›ì¸ ê²½ìš° ë¹„ë°€ë²ˆí˜¸ë„ ì „ë‹¬ (ì‹¤ì œë¡œëŠ” ì„¸ì…˜ì— ì €ì¥í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ)
      params.append('password', 'stored_password');
    }

    window.location.href = `refund_request_form.html?${params.toString()}`;
  }

  async function handleCancelOrder(detail) {
    const reason = prompt('ì£¼ë¬¸ ì·¨ì†Œ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ìµœëŒ€ 100ì):');
    if (!reason || reason.trim().length === 0) {
      alert('ì·¨ì†Œ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    if (reason.length > 100) {
      alert('ì·¨ì†Œ ì‚¬ìœ ëŠ” 100ì ì´ë‚´ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    if (confirm('ì •ë§ ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      try {
        // const response = await fetch(`${API_BASE}/${detail.id}/cancel`, {
        //     method: 'POST',
        //     headers: { 'Content-Type': 'application/json' },
        //     body: JSON.stringify({
        //         orderId: detail.id,
        //         cancelReason: reason
        //     })
        // });

        alert('ì£¼ë¬¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
        if (currentMode === 'MEMBER_MODE') {
          showMemberHistory();
          fetchMemberOrders(USER_ID);
        } else {
          showGuestLookupForm();
        }
      } catch (error) {
        alert('ì£¼ë¬¸ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        console.error(error);
      }
    }
  }

  async function handleRevokeReturn(detail) {
    if (confirm('ë°˜í’ˆ ì‹ ì²­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      try {
        // const response = await fetch(`${API_BASE}/${detail.id}/return/cancel`, {
        //     method: 'POST',
        //     headers: { 'Content-Type': 'application/json' }
        // });

        alert('ë°˜í’ˆ ì‹ ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
        if (currentMode === 'MEMBER_MODE') {
          showMemberHistory();
          fetchMemberOrders(USER_ID);
        } else {
          showGuestLookupForm();
        }
      } catch (error) {
        alert('ë°˜í’ˆ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        console.error(error);
      }
    }
  }

  async function handleGuestLookup(e) {
    e.preventDefault();
    const orderId = document.getElementById('guestOrderId').value;
    const orderer = document.getElementById('guestOrderer').value;
    const password = document.getElementById('guestPassword').value;

    // Mock validation
    if (orderId === 'G1001' && orderer === 'ë¹„íšŒì›' && password === '1234') {
      alert('ì¡°íšŒ ì„±ê³µ! ì£¼ë¬¸ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
      fetchOrderDetail(orderId, 'GUEST_MODE');
    } else {
      alert('ì£¼ë¬¸ ì •ë³´ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    }
  }
</script>
</body>
</html>