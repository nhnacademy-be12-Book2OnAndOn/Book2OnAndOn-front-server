<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ë¬¸ ë‚´ì—­ í™•ì¸ - Book2OnAndOn</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header {
            background: #4A7C59;
            color: white;
            padding: 25px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(74, 124, 89, 0.3);
            margin-bottom: 30px;
        }
        header h1 { font-size: 1.8em; margin-bottom: 5px; }
        header p { opacity: 0.9; font-size: 0.95em; }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .card h2 {
            color: #4A7C59;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 3px solid #4A7C59;
            padding-bottom: 10px;
        }
        .card p { color: #666; line-height: 1.6; margin-bottom: 20px; }

        .form-group { margin-bottom: 20px; }
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }
        .form-group input:focus {
            outline: none;
            border-color: #4A7C59;
            box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.1);
        }

        .btn {
            background: #4A7C59;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        .btn:hover {
            background: #3d6549;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 124, 89, 0.3);
        }

        .order-list { display: grid; gap: 20px; }
        .order-item {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
            background: #fafafa;
            cursor: pointer;
        }
        .order-item:hover {
            border-color: #4A7C59;
            box-shadow: 0 5px 20px rgba(74, 124, 89, 0.15);
            transform: translateY(-2px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        .order-number { font-size: 1.2em; font-weight: bold; color: #4A7C59; }
        .order-date { color: #666; font-size: 0.9em; margin-top: 5px; }

        .status-badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            white-space: nowrap;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-shipping { background: #d1ecf1; color: #0c5460; }
        .status-delivered { background: #d4edda; color: #155724; }
        .status-canceled { background: #f8d7da; color: #721c24; }
        .status-return { background: #fff3cd; color: #856404; }

        .order-body {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .info-item { display: flex; flex-direction: column; }
        .info-label { font-size: 0.85em; color: #666; margin-bottom: 5px; }
        .info-value { font-weight: 600; color: #333; }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        .empty-state-icon { font-size: 4em; margin-bottom: 20px; opacity: 0.3; }
        .empty-state h3 { font-size: 1.3em; margin-bottom: 10px; color: #333; }

        .link { color: #4A7C59; text-decoration: none; font-weight: 600; }
        .link:hover { text-decoration: underline; }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            .order-body { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>ğŸ“¦ ì£¼ë¬¸ ë‚´ì—­ í™•ì¸</h1>
        <p>Book2OnAndOnì—ì„œ ì£¼ë¬¸í•˜ì‹  ë‚´ì—­ì„ í™•ì¸í•˜ì„¸ìš”</p>
    </header>

    <!-- ë¹„íšŒì› ì£¼ë¬¸ ì¡°íšŒ -->
    <section id="guestLookupSection" class="hidden">
        <div class="card">
            <h2>ë¹„íšŒì› ì£¼ë¬¸ ì¡°íšŒ</h2>
            <p>ì£¼ë¬¸ ì‹œ ì…ë ¥í–ˆë˜ ì •ë³´ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

            <form id="guestLookupForm">
                <div class="form-group">
                    <input type="text" id="guestOrderId" placeholder="ì£¼ë¬¸ ë²ˆí˜¸" required>
                </div>
                <div class="form-group">
                    <input type="text" id="guestOrderer" placeholder="ì£¼ë¬¸ì ì´ë¦„" required>
                </div>
                <div class="form-group">
                    <input type="password" id="guestPassword" placeholder="ì£¼ë¬¸ ë¹„ë°€ë²ˆí˜¸ (ë˜ëŠ” ì—°ë½ì²˜ ë 4ìë¦¬)" required>
                </div>
                <button type="submit" class="btn">ì£¼ë¬¸ ì¡°íšŒ</button>
            </form>

            <p style="margin-top: 20px; text-align: center;">
                í˜¹ì€ <a href="#" id="memberLoginLink" class="link">ë¡œê·¸ì¸</a>í•˜ì—¬ ì „ì²´ ì£¼ë¬¸ ë‚´ì—­ì„ í™•ì¸í•˜ì„¸ìš”.
            </p>
        </div>
    </section>

    <!-- íšŒì› ì£¼ë¬¸ ëª©ë¡ -->
    <section id="memberHistorySection" class="hidden">
        <div class="card">
            <h2>ì „ì²´ ì£¼ë¬¸ ë‚´ì—­ (<span id="userNameDisplay">íšŒì›</span>ë‹˜)</h2>
            <div id="orderList" class="order-list"></div>

            <div id="noOrdersMessage" class="empty-state hidden">
                <div class="empty-state-icon">ğŸ“­</div>
                <h3>ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ì•„ì§ ì£¼ë¬¸í•˜ì‹  ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
    </section>
</div>

<script>
    // ===== ì‹¤ì œ ì—°ë™ ì‹œ ì—¬ê¸°ë§Œ êµì²´ =====
    const API_BASE = '/orders';

    // ë°ëª¨/ëª©ì—… ê°’
    const USER_ID = 10;
    const USER_NAME = 'íšŒì›';
    const IS_MEMBER_LOGGED_IN = true; // ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼ ë¶„ê¸°

    const ORDER_STATUS = {
        PENDING: { text: "ì£¼ë¬¸ ëŒ€ê¸°", class: "status-pending" },
        SHIPPING: { text: "ë°°ì†¡ì¤‘", class: "status-shipping" },
        DELIVERED: { text: "ë°°ì†¡ ì™„ë£Œ", class: "status-delivered" },
        CANCELED: { text: "ì£¼ë¬¸ ì·¨ì†Œ", class: "status-canceled" },
        COMPLETED: { text: "ì£¼ë¬¸ ì™„ë£Œ", class: "status-delivered" },
        RETURN_REQUESTED: { text: "ë°˜í’ˆ ì‹ ì²­", class: "status-return" },
        RETURN_COMPLETED: { text: "ë°˜í’ˆ ì™„ë£Œ", class: "status-canceled" }
    };

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('userNameDisplay').textContent = USER_NAME;
        setupEventListeners();
        initializeView();
    });

    function setupEventListeners() {
        document.getElementById('guestLookupForm')?.addEventListener('submit', handleGuestLookup);

        document.getElementById('memberLoginLink')?.addEventListener('click', (e) => {
            e.preventDefault();
            // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
            alert('ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™(ëª©ì—…)');
        });
    }

    function initializeView() {
        // history í˜ì´ì§€ì—ì„œëŠ” mode íŒŒë¼ë¯¸í„°ë¡œ ê°•ì œ guest í™”ë©´ë„ ê°€ëŠ¥
        const urlParams = new URLSearchParams(window.location.search);
        const mode = urlParams.get('mode'); // "guest"ë©´ ë¹„íšŒì› í™”ë©´ ê°•ì œ
        const forceGuestMode = mode === 'guest';

        const isLoggedIn = IS_MEMBER_LOGGED_IN && !forceGuestMode;

        if (isLoggedIn) {
            showMemberHistory();
            fetchMemberOrders(USER_ID);
        } else {
            showGuestLookupForm();
        }
    }

    function hideAllSections() {
        document.getElementById('guestLookupSection').classList.add('hidden');
        document.getElementById('memberHistorySection').classList.add('hidden');
    }

    function showGuestLookupForm() {
        hideAllSections();
        document.getElementById('guestLookupSection').classList.remove('hidden');
    }

    function showMemberHistory() {
        hideAllSections();
        document.getElementById('memberHistorySection').classList.remove('hidden');
    }

    async function fetchMemberOrders(userId) {
        // TODO: ì‹¤ì œ ì—°ë™ ì‹œ ì•„ë˜ ëª©ì—…ì„ fetchë¡œ êµì²´
        // const res = await fetch(`${API_BASE}/users/${userId}`, { headers: ... })
        // const orders = await res.json();

        const mockOrders = [
            { orderId: 'M1001', date: '2025-12-10', total: 45000, status: 'PENDING', items: [{name: 'í´ë¦° ì½”ë“œ', count: 1}] },
            { orderId: 'M1002', date: '2025-11-20', total: 72000, status: 'DELIVERED', items: [{name: 'ê°ì²´ì§€í–¥ ì„¤ê³„', count: 2}] },
            { orderId: 'M1003', date: '2025-11-01', total: 30000, status: 'SHIPPING', items: [{name: 'ì•Œê³ ë¦¬ì¦˜', count: 1}] },
            { orderId: 'M1004', date: '2025-10-25', total: 50000, status: 'RETURN_REQUESTED', items: [{name: 'ìë°”ì˜ ì •ì„', count: 1}] },
            { orderId: 'M1005', date: '2025-10-20', total: 20000, status: 'CANCELED', items: [{name: 'ì›¹ ê°œë°œ', count: 1}] },
        ];

        renderOrderList(mockOrders);
    }

    function renderOrderList(orders) {
        const listContainer = document.getElementById('orderList');
        listContainer.innerHTML = '';

        if (!orders || orders.length === 0) {
            document.getElementById('noOrdersMessage').classList.remove('hidden');
            return;
        }
        document.getElementById('noOrdersMessage').classList.add('hidden');

        orders.forEach(order => {
            const statusInfo = ORDER_STATUS[order.status] || { text: order.status, class: "status-pending" };

            const orderDiv = document.createElement('div');
            orderDiv.className = 'order-item';
            orderDiv.onclick = () => {
                // ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
                const params = new URLSearchParams({
                    orderId: order.orderId,
                    mode: 'MEMBER_MODE'
                });
                window.location.href = `order_detail.html?${params.toString()}`;
            };

            orderDiv.innerHTML = `
        <div class="order-header">
          <div>
            <div class="order-number">ì£¼ë¬¸ë²ˆí˜¸: ${order.orderId}</div>
            <div class="order-date">${order.date}</div>
          </div>
          <span class="status-badge ${statusInfo.class}">${statusInfo.text}</span>
        </div>
        <div class="order-body">
          <div class="info-item">
            <span class="info-label">ìƒí’ˆ</span>
            <span class="info-value">
              ${order.items[0].name} ${order.items.length > 1 ? `ì™¸ ${order.items.length - 1}ê±´` : ''}
            </span>
          </div>
          <div class="info-item">
            <span class="info-label">ì´ ê¸ˆì•¡</span>
            <span class="info-value">${order.total.toLocaleString()}ì›</span>
          </div>
        </div>
      `;

            listContainer.appendChild(orderDiv);
        });
    }

    async function handleGuestLookup(e) {
        e.preventDefault();
        const orderId = document.getElementById('guestOrderId').value;
        const orderer = document.getElementById('guestOrderer').value;
        const password = document.getElementById('guestPassword').value;

        // TODO: ì‹¤ì œ ì—°ë™ ì‹œ ì¸ì¦ API í˜¸ì¶œë¡œ ë³€ê²½
        // const res = await fetch(`${API_BASE}/guest/lookup`, { ... })
        // ì„±ê³µ ì‹œ ìƒì„¸ë¡œ ì´ë™

        // ëª©ì—… ê²€ì¦
        if (orderId === 'G1001' && orderer === 'ë¹„íšŒì›' && password === '1234') {
            const params = new URLSearchParams({
                orderId,
                mode: 'GUEST_MODE'
                // ë¹„íšŒì› passwordë¥¼ ì¿¼ë¦¬ë¡œ ë„˜ê¸°ëŠ” ê±´ ë³´ì•ˆìƒ ê¶Œì¥ë˜ì§€ ì•ŠìŒ.
                // ì‹¤ì œë¡œëŠ” ì„œë²„ ì„¸ì…˜/í† í°/ì¼íšŒì„± ì¸ì¦í‚¤ë¡œ ëŒ€ì²´.
            });
            window.location.href = `order_detail.html?${params.toString()}`;
        } else {
            alert('ì£¼ë¬¸ ì •ë³´ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }
    }
</script>
</body>
</html>
