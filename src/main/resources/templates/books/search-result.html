<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>검색 결과 - Book2OnAndOn</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <style>
        .search-summary {
            background: #fff;
            padding: 1.5rem 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .search-keyword {
            color: #2d5f3f;
            font-weight: 700;
            font-size: 1.2rem;
        }
        .no-result {
            text-align: center;
            padding: 4rem 0;
            color: #6b7280;
        }
        .book-link-overlay {
            position: absolute;
            inset: 0;
            z-index: 1;
        }
        .sort-select {
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            color: #374151;
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
        }
        .pagination button {
            padding: 0.5rem 1rem;
            margin: 0 0.2rem;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
            border-radius: 4px;
        }
        .pagination button.active {
            background-color: #2d5f3f;
            color: white;
            border-color: #2d5f3f;
        }
        .pagination button:hover:not(.active) {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body>

<th:block th:replace="~{fragments/layout :: commonHeader(${currentUser}, ${cartCount}, null, null, false)}"></th:block>

<main class="container book-section" style="margin-top: 2rem;">

    <div class="search-summary">
        <div>
            <span class="search-keyword">"<span th:text="${condition.keyword}">키워드</span>"</span>
            검색 결과
            <span style="margin-left: 10px; color: #6b7280; font-size: 0.9rem;">
                (총 <b th:text="${page.totalElements}">0</b>건)
            </span>
        </div>

        <div class="section-actions">
            <select class="sort-select" onchange="location.href=this.value">
                <option th:value="@{/books/search(keyword=${condition.keyword}, sort='score')}"
                        th:selected="${condition.sort == null or condition.sort.toString() == 'score'}">정확도순</option>

                <option th:value="@{/books/search(keyword=${condition.keyword}, sort='publishDate,desc')}"
                        th:selected="${condition.sort != null and condition.sort.toString().contains('publishDate')}">최신순</option>

                <option th:value="@{/books/search(keyword=${condition.keyword}, sort='popularity,desc')}"
                        th:selected="${condition.sort != null and condition.sort.toString().contains('popularity')}">인기순</option>

                <option th:value="@{/books/search(keyword=${condition.keyword}, sort='priceSales,asc')}"
                        th:selected="${condition.sort != null and condition.sort.toString() == 'priceSales,asc'}">가격 낮은순</option>

                <option th:value="@{/books/search(keyword=${condition.keyword}, sort='priceSales,desc')}"
                        th:selected="${condition.sort != null and condition.sort.toString() == 'priceSales,desc'}">가격 높은순</option>
            </select>
        </div>
    </div>

    <div th:if="${books.isEmpty()}" class="no-result">
        <h3 style="margin-bottom: 1rem; color: #2d5f3f;">검색 결과가 없습니다.</h3>
        <p>단어의 철자가 정확한지 확인해 주세요.</p>
        <a href="/" class="btn primary" style="margin-top: 2rem; display:inline-block; padding: 10px 20px; background-color: #2d5f3f; color: white; text-decoration: none; border-radius: 5px;">메인으로 돌아가기</a>
    </div>

    <div th:unless="${books.isEmpty()}" class="book-grid">
        <div th:each="book : ${books}" class="book-card">
            <div class="book-cover">
                <img th:src="${book.thumbnail != null and book.thumbnail != '' ? book.thumbnail : 'https://via.placeholder.com/200x300?text=No+Image'}"
                     alt="도서 표지"
                     style="width: 100%; height: 280px; object-fit: cover;" />
            </div>

            <div class="book-details">
                <h3 class="book-title" th:text="${book.title}"
                    style="font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    도서 제목
                </h3>

                <p class="book-author"
                   th:text="${book.contributorNames != null ? #strings.listJoin(book.contributorNames, ', ') : ''}">저자명</p>

                <div class="book-meta">
                    <div class="rating">
                        <span>★</span>
                        <span th:text="${book.reviewRating != null ? book.reviewRating : '0.0'}">0.0</span>
                    </div>
                    <div class="price-info">
                        <span class="price" th:text="${#numbers.formatInteger(book.priceSales, 0, 'COMMA') + '원'}">15,000원</span>

                        <span class="origin" th:if="${book.priceStandard > book.priceSales}"
                              th:text="${#numbers.formatInteger(book.priceStandard, 0, 'COMMA') + '원'}"
                              style="text-decoration: line-through; color: #999; font-size: 0.9em; margin-left: 5px;">
                                18,000원
                        </span>
                    </div>
                </div>
            </div>

            <a th:href="@{/books/{id}(id=${book.id})}" class="book-link-overlay"></a>

            <button class="cart-button" style="z-index: 2; margin-top: 10px;">
                장바구니 담기
            </button>
        </div>
    </div>

    <div th:if="${!books.isEmpty()}" class="pagination" style="margin-top: 2rem; display: flex; justify-content: center;">
        <button th:if="${page.hasPrevious()}"
                th:onclick="|location.href='@{/books/search(keyword=${condition.keyword}, sort=${condition.sort}, page=${page.number - 1})}'|">
            &lt;
        </button>

        <th:block th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}">
            <button th:if="${i >= page.number - 2 and i <= page.number + 2}"
                    th:classappend="${i == page.number} ? 'active'"
                    th:text="${i + 1}"
                    th:onclick="|location.href='@{/books/search(keyword=${condition.keyword}, sort=${condition.sort}, page=${i})}'|">
                1
            </button>
        </th:block>

        <button th:if="${page.hasNext()}"
                th:onclick="|location.href='@{/books/search(keyword=${condition.keyword}, sort=${condition.sort}, page=${page.number + 1})}'|">
            &gt;
        </button>
    </div>

</main>

<th:block th:replace="~{fragments/layout :: commonFooter}"></th:block>

</body>
</html>