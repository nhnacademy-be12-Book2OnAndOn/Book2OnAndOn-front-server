<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²€ìƒ‰ ê²°ê³¼ - Book2OnAndOn</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <style>
        .search-summary {
            background: #fff;
            padding: 1.5rem 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); /* ë³€ìˆ˜ ëŒ€ì²´ */
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .search-keyword {
            color: #2d5f3f; /* ë³€ìˆ˜ ëŒ€ì²´ */
            font-weight: 700;
            font-size: 1.2rem;
        }
        .no-result {
            text-align: center;
            padding: 4rem 0;
            color: #6b7280; /* ë³€ìˆ˜ ëŒ€ì²´ */
        }
        .book-link-overlay {
            position: absolute;
            inset: 0;
            z-index: 1;
        }
        /* ì •ë ¬ ì„ íƒ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .sort-select {
            padding: 0.5rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            color: #374151;
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
        }
        /* í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³´ì™„ */
        .pagination button {
            padding: 0.5rem 1rem;
            margin: 0 0.2rem;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
            border-radius: 4px;
        }
        .pagination button.active {
            background-color: #2d5f3f;
            color: white;
            border-color: #2d5f3f;
        }
        .pagination button:hover:not(.active) {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body>

<header class="main-header">
    <div class="container header-bar">
        <div class="logo-wrap">
            <a href="/" class="logo-link">
                <span class="brand-name">BOOK2</span>
            </a>
        </div>

        <div class="global-search">
            <form action="/books/search" method="get" class="group">
                <input type="hidden" name="sort" th:value="${condition.sort}">

                <input type="text" class="input" name="keyword"
                       th:value="${condition.keyword}"
                       placeholder="ì°¾ìœ¼ì‹œëŠ” ë„ì„œëª…, ì €ì, ISBNì„ ì…ë ¥í•˜ì„¸ìš”" />
                <button type="submit" style="background:none; border:none; cursor:pointer; position:absolute; right:1rem;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="#2d5f3f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </form>
        </div>

        <div class="header-actions">
            <a href="/cart" class="icon-btn cart">
                <span class="fi fi-rs-cart">ğŸ›’</span>
            </a>
            <a href="/login" class="text-link">ë¡œê·¸ì¸</a>
        </div>
    </div>
</header>

<main class="container book-section">

    <div class="search-summary">
        <div>
            <span class="search-keyword">"<span th:text="${condition.keyword}">í‚¤ì›Œë“œ</span>"</span>
            ê²€ìƒ‰ ê²°ê³¼
            <span style="margin-left: 10px; color: #6b7280; font-size: 0.9rem;">
                (ì´ <b th:text="${page.totalElements}">0</b>ê±´)
            </span>
        </div>

        <div class="section-actions">
            <select class="sort-select" onchange="location.href=this.value">
                <option th:value="@{/books/search(keyword=${condition.keyword}, sort='RECENT')}"
                        th:selected="${condition.sort == 'RECENT' or condition.sort == null}">ìµœì‹ ìˆœ</option>
                <option th:value="@{/books/search(keyword=${condition.keyword}, sort='LIKE_DESC')}"
                        th:selected="${condition.sort == 'LIKE_DESC'}">ì¸ê¸°ìˆœ</option>
                <option th:value="@{/books/search(keyword=${condition.keyword}, sort='PRICE_ASC')}"
                        th:selected="${condition.sort == 'PRICE_ASC'}">ê°€ê²© ë‚®ì€ìˆœ</option>
                <option th:value="@{/books/search(keyword=${condition.keyword}, sort='PRICE_DESC')}"
                        th:selected="${condition.sort == 'PRICE_DESC'}">ê°€ê²© ë†’ì€ìˆœ</option>
            </select>
        </div>
    </div>

    <div th:if="${books.isEmpty()}" class="no-result">
        <h3 style="margin-bottom: 1rem; color: #2d5f3f;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</h3>
        <p>ë‹¨ì–´ì˜ ì² ìê°€ ì •í™•í•œì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
        <a href="/" class="btn primary" style="margin-top: 2rem; display:inline-block; padding: 10px 20px; background-color: #2d5f3f; color: white; text-decoration: none; border-radius: 5px;">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <div th:unless="${books.isEmpty()}" class="book-grid">

        <div th:each="book : ${books}" class="book-card">
            <div class="book-cover">
                <img th:src="${book.imagePath != null and book.imagePath != '' ? book.imagePath : 'https://via.placeholder.com/200x300?text=No+Image'}"
                     alt="ë„ì„œ í‘œì§€"
                     style="width: 100%; height: 280px; object-fit: cover;" />
            </div>

            <div class="book-details">
                <h3 class="book-title" th:text="${book.title}"
                    style="font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    ë„ì„œ ì œëª©
                </h3>

                <p class="book-author"
                   th:text="${#strings.listJoin(book.contributorNames, ', ')}">ì €ìëª…</p>

                <div class="book-meta">
                    <div class="rating">
                        <span>â˜…</span>
                        <span th:text="${book.rating != null ? book.rating : '0.0'}">0.0</span>
                    </div>
                    <div class="price-info">
                        <span class="price" th:text="${#numbers.formatInteger(book.priceSales, 0, 'COMMA') + 'ì›'}">15,000ì›</span>

                        <span class="origin" th:if="${book.priceStandard > book.priceSales}"
                              th:text="${#numbers.formatInteger(book.priceStandard, 0, 'COMMA') + 'ì›'}"
                              style="text-decoration: line-through; color: #999; font-size: 0.9em; margin-left: 5px;">
                                18,000ì›
                        </span>
                    </div>
                </div>
            </div>

            <a th:href="@{/books/{id}(id=${book.id})}" class="book-link-overlay"></a>

            <button class="cart-button" style="z-index: 2; margin-top: 10px;">
                ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°
            </button>
        </div>

    </div>

    <div th:if="${!books.isEmpty()}" class="pagination" style="margin-top: 2rem; display: flex; justify-content: center;">

        <button th:if="${page.hasPrevious()}"
                th:onclick="|location.href='@{/books/search(keyword=${condition.keyword}, sort=${condition.sort}, page=${page.number - 1})}'|">
            &lt;
        </button>

        <th:block th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}">
            <button th:if="${i >= page.number - 2 and i <= page.number + 2}"
                    th:classappend="${i == page.number} ? 'active'"
                    th:text="${i + 1}"
                    th:onclick="|location.href='@{/books/search(keyword=${condition.keyword}, sort=${condition.sort}, page=${i})}'|">
                1
            </button>
        </th:block>

        <button th:if="${page.hasNext()}"
                th:onclick="|location.href='@{/books/search(keyword=${condition.keyword}, sort=${condition.sort}, page=${page.number + 1})}'|">
            &gt;
        </button>
    </div>

</main>

<footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div>
                <h4>BOOK2 ON & ON</h4>
                <p>ë‹¹ì‹ ì˜ ì§€ì‹ì„ ê¹¨ìš°ëŠ” ì‹œê°„</p>
            </div>
            <div class="copyright">
                &copy; 2025 Book2OnAndOn. All rights reserved.
            </div>
        </div>
    </div>
</footer>

</body>
</html>