<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>검색 결과 - Book2OnAndOn</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <style>
        .search-summary {
            background: #fff;
            padding: 1.5rem 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-soft);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .search-keyword {
            color: var(--green-700);
            font-weight: 700;
            font-size: 1.2rem;
        }
        .no-result {
            text-align: center;
            padding: 4rem 0;
            color: var(--gray-500);
        }
        .book-link-overlay {
            position: absolute;
            inset: 0;
            z-index: 1;
        }
    </style>
</head>
<body>

<header class="main-header">
    <div class="container header-bar">
        <div class="logo-wrap">
            <a href="/" class="logo-link">
                <span class="brand-name">BOOK2</span>
            </a>
        </div>

        <div class="global-search">
            <form action="/books/search" method="get" class="group">
                <input type="text" class="input" name="keyword"
                       th:value="${condition.keyword}"
                       placeholder="찾으시는 도서명, 저자, ISBN을 입력하세요" />
                <button type="submit" style="background:none; border:none; cursor:pointer; position:absolute; right:1rem;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="#2d5f3f" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </form>
        </div>

        <div class="header-actions">
            <a href="/cart" class="icon-btn cart">
                <span class="fi fi-rs-cart"></span>
            </a>
            <a href="/login" class="text-link">로그인</a>
        </div>
    </div>
</header>

<main class="container book-section">

    <div class="search-summary">
        <div>
            <span class="search-keyword">"<span th:text="${condition.keyword}">키워드</span>"</span>
            검색 결과
        </div>
        <div class="section-actions">
            <span class="count">총 <b th:text="${page.totalElements}">0</b>건</span>
        </div>
    </div>

    <div th:if="${books.isEmpty()}" class="no-result">
        <h3 style="margin-bottom: 1rem; color: var(--green-800);">검색 결과가 없습니다.</h3>
        <p>단어의 철자가 정확한지 확인해 주세요.</p>
        <a href="/" class="btn primary" style="margin-top: 2rem;">메인으로 돌아가기</a>
    </div>

    <div th:unless="${books.isEmpty()}" class="book-grid">

        <div th:each="book : ${books}" class="book-card">

            <div class="book-cover">
                <img th:src="${book.imagePath} ?: 'https://via.placeholder.com/200x300?text=No+Image'"
                     alt="도서 표지"
                     style="width: 100%; height: 280px; object-fit: cover;" />
            </div>

            <div class="book-details">
                <h3 class="book-title" th:text="${book.title}"
                    style="font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                    도서 제목
                </h3>

                <p class="book-author" th:text="${book.contributorNames}">저자명</p>

                <div class="book-meta">
                    <div class="rating">
                        <span>★</span>
                        <span th:text="${book.rating}">0.0</span>
                    </div>
                    <div class="price-info">
                        <span class="price" th:text="${#numbers.formatInteger(book.priceSales, 0, 'COMMA') + '원'}">15,000원</span>

                        <span class="origin" th:if="${book.priceStandard > book.priceSales}"
                              th:text="${#numbers.formatInteger(book.priceStandard, 0, 'COMMA') + '원'}">
                                18,000원
                            </span>
                    </div>
                </div>
            </div>

            <a th:href="@{/books/{id}(id=${book.id})}" class="book-link-overlay"></a>

            <button class="cart-button" style="z-index: 2; margin-top: 10px;">
                장바구니 담기
            </button>
        </div>

    </div>

    <div th:if="${!books.isEmpty()}" class="pagination">
        <button th:if="${page.hasPrevious()}"
                th:onclick="|location.href='@{/books/search(keyword=${condition.keyword}, page=${page.number - 1})}'|">
            &lt;
        </button>

        <th:block th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}">
            <button th:if="${i >= page.number - 2 and i <= page.number + 2}"
                    th:classappend="${i == page.number} ? 'active'"
                    th:text="${i + 1}"
                    th:onclick="|location.href='@{/books/search(keyword=${condition.keyword}, page=${i})}'|">
                1
            </button>
        </th:block>

        <button th:if="${page.hasNext()}"
                th:onclick="|location.href='@{/books/search(keyword=${condition.keyword}, page=${page.number + 1})}'|">
            &gt;
        </button>
    </div>

</main>

<footer class="site-footer">
    <div class="container">
        <div class="footer-grid">
            <div>
                <h4>BOOK2 ON & ON</h4>
                <p>당신의 지식을 깨우는 시간</p>
            </div>
            <div class="copyright">
                &copy; 2025 Book2OnAndOn. All rights reserved.
            </div>
        </div>
    </div>
</footer>

</body>
</html>