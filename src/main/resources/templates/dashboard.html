<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main-layout}">
<head>
    <title layout:fragment="title">Book2OnAndOn - 온라인 서점</title>
</head>
<body>
<main layout:fragment="content" th:with="currentUser=${user ?: session.user}">
    <section class="hero">
        <div class="container hero-inner">
            <div class="hero-text">
                <p class="hero-badge" th:text="${promotion?.badge} ?: '이번 주 특별 할인'">이번 주 특별 할인</p>
                <h1>책으로 떠나는 <br> 무한한 여행</h1>
                <p class="hero-desc">
                    Book2OnAndOn에서 다양한 장르의 도서를 만나보세요. <br> 베스트셀러부터 숨은 명작까지 모두 한 곳에서.
                </p>
                <div class="hero-actions">
                    <a class="btn primary" th:href="@{/books/bestsellers}">베스트셀러 보기</a>
                    <a class="btn secondary" th:href="@{/books/new}">신간 도서</a>
                </div>
            </div>

            <div class="hero-visual">
                <div class="hero-card">
                    <div class="hero-image">
                        <img alt="추천 도서" onerror="this.onerror=null; this.src='/images/no-image.png';"
                             th:if="${promotion?.imageUrl != null}" th:src="${promotion.imageUrl}">
                        <img alt="기본 이미지"
                             src="https://images.unsplash.com/photo-1473755504818-b72b6dfdc226?auto=format&fit=crop&w=820&q=80"
                             th:if="${promotion?.imageUrl == null}">
                    </div>
                    <div class="hero-price" th:if="${promotion != null}">
                        <p class="label" th:text="${promotion.subtitle} ?: '오늘의 추천 세트'">오늘의 추천 세트</p>
                        <div class="price-row">
                            <span class="sale-price"
                                  th:text="${promotion.salePrice} != null ? '₩' + ${#numbers.formatInteger(promotion.salePrice, 0, 'COMMA')} : ''">₩79,800</span>
                            <span class="original" th:if="${promotion.originalPrice != null}"
                                  th:text="'₩' + ${#numbers.formatInteger(promotion.originalPrice, 0, 'COMMA')}">₩99,000</span>
                        </div>
                        <p class="discount" th:if="${promotion.discountRate != null}"
                           th:text="${promotion.discountRate} + '% 할인'">20% 할인</p>
                        <button class="btn ghost" th:onclick="'addToCart(' + ${promotion.id} + ')'"><span>장바구니 담기</span></button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="book-collection" id="section-new" th:if="${newBooks != null}">
        <div class="container">
            <div class="section-header">
                <div>
                    <p class="section-eyebrow">따끈따끈한 신간을 가장 먼저 만나보세요</p>
                    <h2>신간 도서</h2>
                </div>
                <div class="section-actions">
                    <a class="view-all" th:href="@{/books/new}">전체보기 →</a>
                </div>
            </div>
            <div th:replace="~{fragments/dashboard :: sliderSection('newSlider', ${newBooks}, 'NEW')}"></div>
        </div>
    </section>

    <section class="book-collection" id="section-bestseller-week" th:if="${bestWeek != null and !bestWeek.isEmpty()}">
        <div class="container">
            <div class="section-header">
                <div>
                    <p class="section-eyebrow">이번주 가장 많이 팔린 책</p>
                    <h2>이번주 베스트 셀러</h2>
                </div>
            </div>
            <div th:replace="~{fragments/dashboard :: sliderSection('bestWeekSlider', ${bestWeek}, 'WEEKLY BEST')}"></div>
        </div>
    </section>

    <section class="mid-promotion" style="padding: 60px 0; background-color: #e8f5e9; margin: 50px 0; border-radius: 12px;">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
            <div class="promo-text">
                <span class="badge" style="background:#2e7d32; color:white; padding:4px 10px; border-radius:4px; font-size:0.8rem; margin-bottom:10px; display:inline-block; font-weight:500;">MD's Pick</span>
                <h2 style="margin: 0 0 10px 0; color: #1b5e20; font-size: 1.8rem;">잠깐, 눈의 피로를 풀어보세요 🌿</h2>
                <p style="margin: 0; color: #33691e; font-size: 1.1rem;">초록빛 표지만 모았다! 싱그러운 식물 & 힐링 에세이 특별전</p>
            </div>
            <div class="promo-action">
                <a href="#" class="btn secondary" style="background:white; border:2px solid #2e7d32; color:#2e7d32; padding: 12px 28px; border-radius: 50px; text-decoration: none; font-weight: bold; transition: all 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                    초록 에디션 보러가기 →
                </a>
            </div>
        </div>
    </section>

    <section class="book-collection" id="section-bestseller-yesterday" style="background-color: #f8f9fa;" th:if="${bestDaily != null and !bestDaily.isEmpty()}">
        <div class="container">
            <div class="section-header">
                <div>
                    <p class="section-eyebrow">어제 가장 뜨거웠던 책</p>
                    <h2>어제 베스트 셀러</h2>
                </div>
            </div>
            <div th:replace="~{fragments/dashboard :: sliderSection('bestDailySlider', ${bestDaily}, 'DAILY BEST')}"></div>
        </div>
    </section>

    <section class="book-collection" id="section-popular" th:if="${likeBest != null}">
        <div class="container">
            <div class="section-header">
                <div>
                    <p class="section-eyebrow">독자들이 선택한</p>
                    <h2>인기 도서</h2>
                </div>
            </div>
            <div th:replace="~{fragments/dashboard :: sliderSection('popularSlider', ${likeBest}, 'POPULAR')}"></div>
        </div>
    </section>

    <th:block th:replace="~{fragments/promotion :: membership-cta}"></th:block>

</main>

<th:block layout:fragment="extraScript">
    <script th:src="@{/js/dashboard.js}"></script>
</th:block>
</body>
</html>