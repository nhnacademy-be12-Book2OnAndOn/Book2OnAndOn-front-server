<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
      th:replace="~{layout/mypage-layout :: layout(
        title = ~{::title},
        sidebarActive = 'addresses',
        content = ~{::content},
        extraHead = ~{::extraHead}
      )}">

<head>
    <meta charset="UTF-8">
    <title th:text="${isUpdate} ? '배송지 수정' : '새 배송지 추가'"></title>
    <th:block th:fragment="extraHead">
        <link rel="stylesheet" th:href="@{/css/mypage-form.css}">
    </th:block>
</head>

<body>

<div th:fragment="content">

    <h2 th:text="${isUpdate} ? '배송지 수정' : '새 배송지 추가'"></h2>

    <div th:if="${error}" class="error-box" th:text="${error}"></div>

    <!-- 수정 폼 -->
    <form th:if="${isUpdate}"
          th:object="${addressForm}"
          th:action="@{/users/me/addresses/{id}/update(id=${addressId})}"
          method="post">

        <div class="form-field">
            <label>배송지 이름</label>
            <label>
                <input type="text" th:field="*{userAddressName}" required>
            </label>
        </div>

        <div class="form-field">
            <label>받는 사람</label>
            <label>
                <input type="text" th:field="*{recipient}" required>
            </label>
        </div>

        <div class="form-field">
            <label>연락처</label>
            <label>
                <input type="text" th:field="*{phone}" required>
            </label>
        </div>

        <div class="form-field">
            <label>주소</label>
            <div class="zip-row">
                <input class="flex-1" type="text" id="zipCode_edit" th:field="*{zipCode}" placeholder="우편번호" readonly>
                <button type="button"
                        onclick="execDaumPostcode('zipCode_edit', 'userAddress_edit', 'userAddressDetail_edit')"
                        class="btn-postcode">우편번호 찾기
                </button>
            </div>

            <input class="mb-8" type="text" id="userAddress_edit" th:field="*{userAddress}" placeholder="도로명 주소" readonly>
            <input type="text" id="userAddressDetail_edit" th:field="*{userAddressDetail}" placeholder="상세 주소">
        </div>

        <div class="form-field">
            <label class="default-toggle">
                <input type="checkbox" th:field="*{isDefault}">
                <span>기본 배송지로 설정</span>
            </label>
        </div>

        <div class="form-actions">
            <a href="/users/me/addresses" class="btn-cancel">취소</a>
            <button type="submit" class="submit-btn">수정하기</button>
        </div>

    </form>

    <!-- 신규 폼 -->
    <form th:unless="${isUpdate}"
          th:object="${addressForm}"
          th:action="@{/users/me/addresses}"
          method="post">

        <div class="form-field">
            <label>배송지 이름</label>
            <label>
                <input type="text" th:field="*{userAddressName}" required>
            </label>
        </div>

        <div class="form-field">
            <label>받는 사람</label>
            <label>
                <input type="text" th:field="*{recipient}" required>
            </label>
        </div>

        <div class="form-field">
            <label>연락처</label>
            <label>
                <input type="text" th:field="*{phone}" required>
            </label>
        </div>

        <div class="form-field">
            <label>주소</label>
            <div class="zip-row">
                <input class="flex-1" type="text" id="zipCode_new" th:field="*{zipCode}" placeholder="우편번호" readonly>
                <button type="button"
                        onclick="execDaumPostcode('zipCode_new', 'userAddress_new', 'userAddressDetail_new')"
                        class="btn-postcode">우편번호 찾기
                </button>
            </div>

            <input class="mb-8" type="text" id="userAddress_new" th:field="*{userAddress}" placeholder="도로명 주소" readonly>
            <input type="text" id="userAddressDetail_new" th:field="*{userAddressDetail}" placeholder="상세 주소">
        </div>

        <div class="form-field">
            <label class="default-toggle">
                <input type="checkbox" th:field="*{isDefault}">
                <span>기본 배송지로 설정</span>
            </label>
        </div>

        <div class="form-actions">
            <a href="/users/me/addresses" class="btn-cancel">취소</a>
            <button type="submit" class="submit-btn">등록하기</button>
        </div>

    </form>

    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        function execDaumPostcode(zipCodeId, addressId, detailId) {
            new daum.Postcode({
                oncomplete: function (data) {
                    var addr = '';

                    if (data.userSelectedType === 'R') {
                        addr = data.roadAddress;
                    } else {
                        addr = data.jibunAddress;
                    }

                    document.getElementById(zipCodeId).value = data.zonecode;
                    document.getElementById(addressId).value = addr;

                    document.getElementById(detailId).focus();
                }
            }).open();
        }
    </script>

</div>

</body>
</html>
