<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë°°ì†¡ ì¡°íšŒ</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .track-container {
            width: 100%;
            max-width: 800px; /* ì•„ì´í”„ë ˆì„ì´ ë“¤ì–´ê°ˆ ê³µê°„ í™•ë³´ */
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .track-header {
            border-bottom: 2px solid #2d5016;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .track-header h2 { margin: 0; color: #333; font-size: 1.5rem; }

        /* ìƒíƒœ ë°°ì§€ (OrderStatus ê¸°ì¤€) */
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            color: white;
        }
        /* ì£¼ë¬¸ ìƒíƒœë³„ ìƒ‰ìƒ ë§¤í•‘ */
        .status-PREPARING { background-color: #ff9800; } /* ë°°ì†¡ì¤€ë¹„ì¤‘ (ì£¼í™©) */
        .status-SHIPPING { background-color: #2196f3; }  /* ë°°ì†¡ì¤‘ (íŒŒë‘) */
        .status-DELIVERED { background-color: #4caf50; } /* ë°°ì†¡ì™„ë£Œ (ì´ˆë¡) */
        .status-DEFAULT { background-color: #9e9e9e; }   /* ê¸°íƒ€ (íšŒìƒ‰) */

        /* ì •ë³´ í…Œì´ë¸” */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
        }
        .info-table th, .info-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .info-table th { width: 120px; color: #666; font-weight: 600; background: #fafafa; }
        .info-table td { color: #333; font-weight: 500; }

        /* ì•„ì´í”„ë ˆì„ ì˜ì—­ */
        .tracking-section {
            margin-top: 2rem;
            border-top: 1px solid #eee;
            padding-top: 1.5rem;
        }

        .tracking-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2d5016;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .iframe-wrapper {
            position: relative;
            width: 100%;
            height: 600px; /* ìŠ¤ë§ˆíŠ¸íƒë°° í™”ë©´ ë†’ì´ */
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: #fff;
        }

        .tracking-frame {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ë¡œë”© ì˜¤ë²„ë ˆì´ */
        .loading-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9);
            display: flex; justify-content: center; align-items: center;
            flex-direction: column;
            color: #666;
            z-index: 10;
            transition: opacity 0.3s;
        }

        /* ìš´ì†¡ì¥ ì—†ì„ ë•Œ */
        .no-info {
            text-align: center;
            padding: 3rem 0;
            color: #999;
            background: #fafafa;
            border-radius: 8px;
            border: 1px dashed #ddd;
        }

        .btn-close {
            display: block;
            width: 100%;
            padding: 12px;
            background: #555;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 2rem;
            transition: background 0.2s;
        }
        .btn-close:hover { background: #333; }
    </style>
</head>
<body>

<div class="track-container">

    <div class="track-header">
        <h2>ğŸ“¦ ë°°ì†¡ ì •ë³´</h2>

        <span class="badge"
              th:classappend="|status-${delivery.orderStatus}|"
              th:switch="${delivery.orderStatus}">
            <span th:case="'PREPARING'">ë°°ì†¡ì¤€ë¹„ì¤‘</span>
            <span th:case="'SHIPPING'">ë°°ì†¡ì¤‘</span>
            <span th:case="'DELIVERED'">ë°°ì†¡ì™„ë£Œ</span>
            <span th:case="*">[[${delivery.orderStatus}]]</span> </span>
    </div>

    <table class="info-table">
        <tr>
            <th>ì£¼ë¬¸ ë²ˆí˜¸</th>
            <td th:text="${delivery.orderId}"></td>
        </tr>
        <tr>
            <th>íƒë°°ì‚¬</th>
            <td th:text="${delivery.deliveryCompany != null ? delivery.deliveryCompany : '-'}"></td>
        </tr>
        <tr>
            <th>ìš´ì†¡ì¥ ë²ˆí˜¸</th>
            <td th:text="${delivery.waybill != null ? delivery.waybill : 'ë“±ë¡ ëŒ€ê¸° ì¤‘'}"></td>
        </tr>
        <tr>
            <th>ë°œì†¡ ì¼ì</th>
            <td th:text="${delivery.deliveryStartedAt != null ? #temporals.format(delivery.deliveryStartedAt, 'yyyy-MM-dd HH:mm') : '-'}"></td>
        </tr>
    </table>

    <div th:if="${delivery.trackingUrl != null && !#strings.isEmpty(delivery.trackingUrl)}" class="tracking-section">
        <div class="tracking-title">
            ğŸ” ìƒì„¸ ë°°ì†¡ íë¦„
        </div>

        <div class="iframe-wrapper">
            <div id="loadingMsg" class="loading-overlay">
                <div class="spinner" style="font-size: 2rem; margin-bottom: 10px;">â³</div>
                <div>íƒë°°ì‚¬ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
            </div>

            <iframe class="tracking-frame"
                    th:src="${delivery.trackingUrl}"
                    onload="document.getElementById('loadingMsg').style.opacity='0'; setTimeout(()=>document.getElementById('loadingMsg').style.display='none', 300);">
            </iframe>
        </div>
    </div>

    <div th:if="${delivery.trackingUrl == null}" class="no-info">
        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸšš</div>
        <p>ì•„ì§ ìš´ì†¡ì¥ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>íŒë§¤ìê°€ ë°œì†¡ ì²˜ë¦¬ë¥¼ í•˜ë©´ ë°°ì†¡ ì¡°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
    </div>

    <button type="button" class="btn-close" onclick="window.close()">ë‹«ê¸°</button>

</div>

</body>
</html>