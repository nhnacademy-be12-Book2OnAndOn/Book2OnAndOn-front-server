<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íšŒì› ìƒì„¸ ì •ë³´ - ê´€ë¦¬ì ì„¼í„°</title>

    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">

    <style>
        /* ìƒì„¸ í˜ì´ì§€ ì „ìš© ì¶”ê°€ ìŠ¤íƒ€ì¼ */
        .detail-card {
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            max-width: 900px;
            margin: 0 auto;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
            margin-top: 30px;
        }

        .section-title:first-child {
            margin-top: 0;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2ì—´ ë°°ì¹˜ */
            gap: 20px;
        }

        .info-item {
            margin-bottom: 15px;
        }

        .info-label {
            display: block;
            font-size: 0.9rem;
            color: #888;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.1rem;
            color: #333;
            font-weight: 500;
        }

        /* ìˆ˜ì • í¼ ìŠ¤íƒ€ì¼ */
        .edit-form-container {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }

        .btn-danger {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
    </style>
</head>
<body>
<th:block
        th:replace="~{fragments/layout :: commonHeader(${user} ?: ${session.user}, ${cartCount}, null, null, false)}"></th:block>
<main>

    <div class="admin-container">
        <th:block th:replace="~{fragments/admin :: adminSidebar('users')}"></th:block>

        <section class="admin-content">
            <div class="admin-header">
                <h2>íšŒì› ìƒì„¸ ì •ë³´</h2>
            </div>

            <div style="background: #ffebee; color: #c62828; padding: 10px; border-radius: 4px; margin-bottom: 20px;"
                 th:if="${param.error}">
                âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
            </div>

            <div class="detail-card">
                <div class="section-title">ğŸ‘¤ ê¸°ë³¸ ì •ë³´</div>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">íšŒì› ë²ˆí˜¸ (ID)</span>
                        <span class="info-value" th:text="${user.userId}">1</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ë¡œê·¸ì¸ ì•„ì´ë””</span>
                        <span class="info-value" th:text="${user.userLoginId}">testuser</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ì´ë¦„</span>
                        <span class="info-value" th:text="${user.name}">í™ê¸¸ë™</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ë‹‰ë„¤ì„</span>
                        <span class="info-value" th:text="${user.nickname}">ìŠˆí¼í™</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ì´ë©”ì¼</span>
                        <span class="info-value" th:text="${user.email}">test@email.com</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ì „í™”ë²ˆí˜¸</span>
                        <span class="info-value" th:text="${user.phone}">010-1234-5678</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">í˜„ì¬ í¬ì¸íŠ¸</span>
                        <span class="info-value" style="color: #2d5016; font-weight: bold;"
                              th:text="${#numbers.formatInteger(user.point, 0, 'COMMA')} + ' P'">5,000 P</span>
                    </div>
                </div>

                <div class="section-title">ğŸ› ï¸ ê´€ë¦¬ì ì„¤ì •</div>
                <div class="edit-form-container">
                    <form method="post" th:action="@{/admin/users/{id}/update(id=${user.userId})}">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="info-label">íšŒì› ë“±ê¸‰</label>
                                <label>
                                    <select name="gradeName">
                                        <option selected th:text="${user.gradeName} + ' (í˜„ì¬)'"
                                                th:value="${user.gradeName}">
                                            CURRENT
                                        </option>
                                        <option value="BASIC">BASIC</option>
                                        <option value="ROYAL">ROYAL</option>
                                        <option value="GOLD">GOLD</option>
                                        <option value="PLATINUM">PLATINUM</option>
                                    </select>
                                </label>
                            </div>

                            <div class="form-group">
                                <label class="info-label">ê³„ì • ìƒíƒœ</label>
                                <label>
                                    <select name="status">
                                        <option selected th:text="${user.status} + ' (í˜„ì¬)'" th:value="${user.status}">
                                            CURRENT
                                        </option>
                                        <option value="ACTIVE">ACTIVE (ì •ìƒ)</option>
                                        <option value="DORMANT">DORMANT (íœ´ë©´)</option>
                                        <option value="CLOSED">CLOSED (íƒˆí‡´)</option>
                                    </select>
                                </label>
                            </div>

                            <div class="form-group">
                                <label class="info-label">ì ‘ê·¼ ê¶Œí•œ</label>
                                <label>
                                    <select name="role">
                                        <option selected th:text="${user.role} + ' (í˜„ì¬)'" th:value="${user.role}">
                                            CURRENT
                                        </option>
                                        <option value="USER">íšŒì›</option>
                                        <option value="MEMBER_ADMIN">íšŒì› ê´€ë¦¬ì</option>
                                        <option value="BOOK_ADMIN">ë„ì„œ ê´€ë¦¬ì</option>
                                        <option value="ORDER_ADMIN">ì£¼ë¬¸ ê´€ë¦¬ì</option>
                                        <option value="COUPON_ADMIN">ì¿ í° ê´€ë¦¬ì</option>
                                        <option value="SUPER_ADMIN">ì´ê´€ë¦¬ì</option>
                                    </select>
                                </label>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <a class="btn-secondary" th:href="@{/admin/users}">ëª©ë¡ìœ¼ë¡œ</a>

                            <button class="btn-danger" onclick="forceDelete()" type="button">ê°•ì œ íƒˆí‡´</button>

                            <button class="btn-primary" style="width: auto;" type="submit">ë³€ê²½ì‚¬í•­ ì €ì¥</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>
</main>
<th:block th:replace="~{fragments/layout :: commonFooter}"></th:block>

<script th:inline="javascript">
    function forceDelete() {
        const userId = /*[[${user.userId}]]*/ 0;
        const userName = '[[${user.name}]]';

        const reason = prompt(`[ê²½ê³ ] '${userName}' íšŒì›ì„ ê°•ì œ íƒˆí‡´ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:`, "ìš´ì˜ ì •ì±… ìœ„ë°˜");

        if (reason) {
            const form = document.createElement('form');
            form.method = 'post';
            form.action = '/admin/users/' + userId + '/delete';

            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'reason';
            input.value = reason;

            form.appendChild(input);
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>

</body>
</html>
