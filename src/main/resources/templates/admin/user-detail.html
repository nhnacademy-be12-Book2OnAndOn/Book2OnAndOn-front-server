<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íšŒì› ìƒì„¸ ì •ë³´ - ê´€ë¦¬ì ì„¼í„°</title>

    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link rel="stylesheet" th:href="@{/css/admin-user-detail.css}">
</head>
<body>
<th:block
        th:replace="~{fragments/layout :: commonHeader(${user} ?: ${session.user}, ${cartCount}, null, null, false)}"></th:block>
<main>

    <div class="admin-container">
        <th:block th:replace="~{fragments/admin :: adminSidebar('users')}"></th:block>

        <section class="admin-content">
            <div class="admin-header">
                <h2>íšŒì› ìƒì„¸ ì •ë³´</h2>
            </div>

            <div class="alert-error" th:if="${param.error}">
                âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
            </div>

            <div class="detail-card">
                <div class="section-title">ğŸ‘¤ ê¸°ë³¸ ì •ë³´</div>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">íšŒì› ë²ˆí˜¸ (ID)</span>
                        <span class="info-value" th:text="${user.userId}">1</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ë¡œê·¸ì¸ ì•„ì´ë””</span>
                        <span class="info-value" th:text="${user.userLoginId}">testuser</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ì´ë¦„</span>
                        <span class="info-value" th:text="${user.name}">í™ê¸¸ë™</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ë‹‰ë„¤ì„</span>
                        <span class="info-value" th:text="${user.nickname}">ìŠˆí¼í™</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ì´ë©”ì¼</span>
                        <span class="info-value" th:text="${user.email}">test@email.com</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">ì „í™”ë²ˆí˜¸</span>
                        <span class="info-value" th:text="${user.phone}">010-1234-5678</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">í˜„ì¬ í¬ì¸íŠ¸</span>
                        <span class="info-value info-value-strong"
                              th:text="${#numbers.formatInteger(user.point, 0, 'COMMA')} + ' P'">5,000 P</span>
                    </div>
                </div>

                <div class="section-title">ğŸ› ï¸ ê´€ë¦¬ì ì„¤ì •</div>
                <div class="edit-form-container">
                    <form method="post" th:action="@{/admin/users/{id}/update(id=${user.userId})}">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="info-label">íšŒì› ë“±ê¸‰</label>
                                <label>
                                    <select name="gradeName">
                                        <option selected th:text="${user.gradeName} + ' (í˜„ì¬)'"
                                                th:value="${user.gradeName}">
                                            CURRENT
                                        </option>
                                        <option value="BASIC">BASIC</option>
                                        <option value="ROYAL">ROYAL</option>
                                        <option value="GOLD">GOLD</option>
                                        <option value="PLATINUM">PLATINUM</option>
                                    </select>
                                </label>
                            </div>

                            <div class="form-group">
                                <label class="info-label">ê³„ì • ìƒíƒœ</label>
                                <label>
                                    <select name="status">
                                        <option selected th:text="${user.status} + ' (í˜„ì¬)'" th:value="${user.status}">
                                            CURRENT
                                        </option>
                                        <option value="ACTIVE">ACTIVE (ì •ìƒ)</option>
                                        <option value="DORMANT">DORMANT (íœ´ë©´)</option>
                                        <option value="CLOSED">CLOSED (íƒˆí‡´)</option>
                                    </select>
                                </label>
                            </div>

                            <div class="form-group">
                                <label class="info-label">ì ‘ê·¼ ê¶Œí•œ</label>
                                <label>
                                    <select name="role">
                                        <option selected th:text="${user.role} + ' (í˜„ì¬)'" th:value="${user.role}">
                                            CURRENT
                                        </option>
                                        <option value="USER">íšŒì›</option>
                                        <option value="MEMBER_ADMIN">íšŒì› ê´€ë¦¬ì</option>
                                        <option value="BOOK_ADMIN">ë„ì„œ ê´€ë¦¬ì</option>
                                        <option value="ORDER_ADMIN">ì£¼ë¬¸ ê´€ë¦¬ì</option>
                                        <option value="COUPON_ADMIN">ì¿ í° ê´€ë¦¬ì</option>
                                        <option value="SUPER_ADMIN">ì´ê´€ë¦¬ì</option>
                                    </select>
                                </label>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <a class="btn-secondary" th:href="@{/admin/users}">ëª©ë¡ìœ¼ë¡œ</a>

                            <button class="btn-danger" onclick="forceDelete()" type="button">ê°•ì œ íƒˆí‡´</button>

                            <button class="btn-primary w-auto" type="submit">ë³€ê²½ì‚¬í•­ ì €ì¥</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>
</main>
<th:block th:replace="~{fragments/layout :: commonFooter}"></th:block>

<script th:inline="javascript">
    function forceDelete() {
        const userId = /*[[${user.userId}]]*/ 0;
        const userName = '[[${user.name}]]';

        const reason = prompt(`[ê²½ê³ ] '${userName}' íšŒì›ì„ ê°•ì œ íƒˆí‡´ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:`, "ìš´ì˜ ì •ì±… ìœ„ë°˜");

        if (reason) {
            const form = document.createElement('form');
            form.method = 'post';
            form.action = '/admin/users/' + userId + '/delete';

            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'reason';
            input.value = reason;

            form.appendChild(input);
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>

</body>
</html>
