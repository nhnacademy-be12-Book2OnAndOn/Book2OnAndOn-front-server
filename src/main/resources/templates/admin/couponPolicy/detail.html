<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê´€ë¦¬ì - ì¿ í° ì •ì±… ìƒì„¸</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .admin-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        /* í—¤ë” ì˜ì—­ */
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }
        .detail-title h2 { margin: 0; color: #333; font-size: 1.8rem; }
        .detail-id { color: #888; font-size: 0.9rem; margin-top: 5px; }

        /* ì»¨í…ì¸  ë°•ìŠ¤ */
        .detail-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2d5016;
            margin-bottom: 1rem;
            border-left: 4px solid #2d5016;
            padding-left: 10px;
        }

        /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem 2rem;
            margin-bottom: 2rem;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .info-label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 600;
        }

        .info-value {
            font-size: 1rem;
            color: #333;
            font-weight: 500;
        }

        /* ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .badge-type { background: #e3f2fd; color: #1565c0; }
        .badge-active { background: #e8f5e9; color: #2e7d32; }
        .badge-deactive { background: #ffebee; color: #c62828; }

        /* ì ìš© ëŒ€ìƒ íƒœê·¸ ìŠ¤íƒ€ì¼ */
        .target-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .target-tag {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #555;
        }
        .empty-text { color: #999; font-style: italic; }

        /* í•˜ë‹¨ ë²„íŠ¼ ê·¸ë£¹ */
        .btn-group {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            border: 1px solid transparent;
            cursor: pointer;
            font-size: 0.95rem;
        }
        .btn-list { background: white; border-color: #ddd; color: #333; }
        .btn-edit { background: #2d5016; color: white; }
        .btn-delete { background: #d32f2f; color: white; }

        /* ì¿ í° ìƒì„± ë²„íŠ¼ (ì£¼í™©ìƒ‰ ê°•ì¡°) */
        .btn-create-coupon { background: #ff6f00; color: white; border: none; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-create-coupon:hover { background: #e65100; transform: translateY(-1px); }

        /* êµ¬ë¶„ì„  */
        .divider { border-top: 1px solid #f0f0f0; margin: 2rem 0; }

        /* ===== ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ===== */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000;
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 2rem; border-radius: 12px; width: 450px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-content h3 { margin-top: 0; color: #333; border-bottom: 2px solid #2d5016; padding-bottom: 10px; display: inline-block; }
        .modal-actions { margin-top: 2rem; display: flex; justify-content: flex-end; gap: 10px; }
        .form-control { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }

        /* ì²´í¬ë°•ìŠ¤ ì»¤ìŠ¤í…€ */
        .checkbox-label {
            user-select: none;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background 0.2s;
        }
        .checkbox-label:hover { background: #f5f5f5; }
        .checkbox-label input { width: 18px; height: 18px; accent-color: #2d5016; }
    </style>
</head>
<body>

<div class="admin-container">

    <div class="detail-header">
        <div class="detail-title">
            <h2 th:text="${policy.couponPolicyName}">ì‹ ê·œ íšŒì› ì›°ì»´ ì¿ í°</h2>
            <div class="detail-id">Policy ID: <span th:text="${policy.couponPolicyId}">101</span></div>
        </div>
        <div>
            <span th:if="${policy.couponPolicyStatus?.name() == 'ACTIVE'}" class="badge badge-active">ì‚¬ìš©ì¤‘</span>
            <span th:if="${policy.couponPolicyStatus?.name() == 'DEACTIVE'}" class="badge badge-deactive">ë¹„í™œì„±</span>
        </div>
    </div>

    <div class="detail-card">

        <div class="section-title">ê¸°ë³¸ ì •ë³´</div>
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">ì¿ í° íƒ€ì…</span>
                <div class="info-value">
                    <span class="badge badge-type" th:text="${policy.couponPolicyType}">WELCOME</span>
                </div>
            </div>
            <div class="info-item">
                <span class="info-label">í• ì¸ ë°©ì‹</span>
                <div class="info-value">
                    <th:block th:if="${policy.couponPolicyDiscountType?.name() == 'PERCENT'}">
                        <span style="color: #2d5016; font-weight: bold;">ì •ë¥ (%) í• ì¸</span>
                    </th:block>
                    <th:block th:if="${policy.couponPolicyDiscountType?.name() == 'FIXED'}">
                        <span style="color: #2d5016; font-weight: bold;">ì •ì•¡(ì›) í• ì¸</span>
                    </th:block>
                </div>
            </div>
            <div class="info-item">
                <span class="info-label">í• ì¸ ê°’</span>
                <div class="info-value">
                    <span style="font-size: 1.2rem; font-weight: bold;"
                          th:text="${#numbers.formatInteger(policy.couponDiscountValue, 0, 'COMMA')}">5,000</span>
                    <span th:text="${policy.couponPolicyDiscountType?.name() == 'PERCENT' ? '%' : 'ì›'}">ì›</span>
                </div>
            </div>
            <div class="info-item">
                <span class="info-label">ìœ íš¨ ê¸°ê°„</span>
                <div class="info-value">
                    <span th:if="${policy.durationDays != null}"
                          th:text="|ë°œê¸‰ì¼ë¡œë¶€í„° ${policy.durationDays}ì¼ê°„|">30ì¼</span>
                    <span th:if="${policy.fixedStartDate != null}">
                        <span th:text="${policy.fixedStartDate}">2024-01-01</span> ~
                        <span th:text="${policy.fixedEndDate}">2024-12-31</span>
                    </span>
                </div>
            </div>
        </div>

        <div class="divider"></div>

        <div class="section-title">ì‚¬ìš© ì¡°ê±´</div>
        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡</span>
                <div class="info-value"
                     th:text="|${#numbers.formatInteger(policy.minPrice, 0, 'COMMA')}ì› ì´ìƒ|">0ì› ì´ìƒ</div>
            </div>
            <div class="info-item">
                <span class="info-label">ìµœëŒ€ í• ì¸ í•œë„</span>
                <div class="info-value">
                    <span th:if="${policy.maxPrice != null}"
                          th:text="|ìµœëŒ€ ${#numbers.formatInteger(policy.maxPrice, 0, 'COMMA')}ì›|">ìµœëŒ€ 5,000ì›</span>
                    <span th:if="${policy.maxPrice == null}" class="empty-text">ì œí•œ ì—†ìŒ</span>
                </div>
            </div>
        </div>

        <div class="divider"></div>

        <div class="section-title">ì ìš© ëŒ€ìƒ</div>
        <div class="info-grid" style="grid-template-columns: 1fr;">

            <div class="info-item">
                <span class="info-label">ì ìš© ë„ì„œ (Book IDs)</span>
                <div class="info-value">
                    <div class="target-list" th:if="${not #lists.isEmpty(policy.targetBookIds)}">
                        <span class="target-tag" th:each="bookId : ${policy.targetBookIds}">
                            ğŸ“• <span th:text="${bookId}">1001</span>
                        </span>
                    </div>
                    <div th:if="${#lists.isEmpty(policy.targetBookIds)}" class="empty-text">ì§€ì •ëœ ë„ì„œ ì—†ìŒ (ì „ì²´ ë„ì„œ ê°€ëŠ¥)</div>
                </div>
            </div>

            <div class="info-item" style="margin-top: 1rem;">
                <span class="info-label">ì ìš© ì¹´í…Œê³ ë¦¬ (Category IDs)</span>
                <div class="info-value">
                    <div class="target-list" th:if="${not #lists.isEmpty(policy.targetCategoryIds)}">
                        <span class="target-tag" th:each="catId : ${policy.targetCategoryIds}">
                            ğŸ“‚ <span th:text="${catId}">10</span>
                        </span>
                    </div>
                    <div th:if="${#lists.isEmpty(policy.targetCategoryIds)}" class="empty-text">ì§€ì •ëœ ì¹´í…Œê³ ë¦¬ ì—†ìŒ</div>
                </div>
            </div>
        </div>

    </div>

    <div class="btn-group">
        <a href="/admin/policies" class="btn btn-list">ëª©ë¡ìœ¼ë¡œ</a>

        <button type="button" class="btn btn-create-coupon"
                th:if="${policy.couponPolicyStatus?.name() == 'ACTIVE'}"
                onclick="openCouponModal()">
            ğŸŸï¸ ì¿ í° ë°œí–‰
        </button>

        <a th:href="@{/admin/policies/update/{id}(id=${policy.couponPolicyId})}" class="btn btn-edit">ìˆ˜ì •</a>

        <form th:action="@{/admin/policies/delete/{id}(id=${policy.couponPolicyId})}" method="post">
            <button type="submit" class="btn btn-delete"
                    onclick="return confirm('ì •ë§ ì´ ì •ì±…ì„ ë¹„í™œì„±í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ë¹„í™œì„±</button>
        </form>
    </div>

</div>

<div id="couponModal" class="modal-overlay">
    <div class="modal-content">
        <h3>ğŸŸï¸ ì¿ í° ë°œí–‰</h3>
        <p style="color: #666; margin-bottom: 20px;">
            ì„ íƒí•œ ì •ì±…(<b>[[${policy.couponPolicyName}]]</b>)ì„ ê¸°ë°˜ìœ¼ë¡œ<br>ì‹¤ì œ ë°œê¸‰ ê°€ëŠ¥í•œ ì¿ í°ì„ ìƒì„±í•©ë‹ˆë‹¤.
        </p>

        <form th:action="@{/admin/policies/{id}/create-coupon(id=${policy.couponPolicyId})}" method="post">
            <div class="form-group">
                <label for="quantity">ë°œí–‰ ìˆ˜ëŸ‰</label>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="number" id="quantity" name="quantity" class="form-control" placeholder="ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 100)" min="1">

                    <label class="checkbox-label" style="white-space: nowrap; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                        <input type="checkbox" id="unlimitedCheck" onchange="toggleQuantityInput()">
                        <span>â™¾ï¸ ë¬´ì œí•œ</span>
                    </label>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-list" onclick="closeCouponModal()">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-create-coupon">í™•ì¸ (ë°œí–‰)</button>
            </div>
        </form>
    </div>
</div>

<script>
    // 1. ì²´í¬ë°•ìŠ¤ ìƒíƒœì— ë”°ë¼ ì…ë ¥ì°½ ì œì–´
    function toggleQuantityInput() {
        const isUnlimited = document.getElementById('unlimitedCheck').checked;
        const quantityInput = document.getElementById('quantity');

        if (isUnlimited) {
            // ë¬´ì œí•œ ì²´í¬ ì‹œ: ì…ë ¥ì°½ ë¹„ìš°ê³ , ë¹„í™œì„±í™”(disabled) -> ì„œë²„ë¡œ ê°’ ì „ì†¡ ì•ˆ ë¨ (null)
            quantityInput.value = '';
            quantityInput.disabled = true;
            quantityInput.placeholder = "ë¬´ì œí•œ ë°œí–‰ ëª¨ë“œ";
            quantityInput.style.backgroundColor = "#f0f0f0"; // íšŒìƒ‰ ì²˜ë¦¬
        } else {
            // ì²´í¬ í•´ì œ ì‹œ: ì…ë ¥ì°½ í™œì„±í™”
            quantityInput.disabled = false;
            quantityInput.placeholder = "ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 100)";
            quantityInput.style.backgroundColor = "white";
            quantityInput.focus();
        }
    }

    // 2. ëª¨ë‹¬ ì—´ê¸° (ì´ˆê¸°í™” í¬í•¨)
    function openCouponModal() {
        document.getElementById('couponModal').style.display = 'flex';

        // ìƒíƒœ ì´ˆê¸°í™”: ë¬´ì œí•œ ì²´í¬ í•´ì œ, ì…ë ¥ì°½ í™œì„±í™”
        document.getElementById('unlimitedCheck').checked = false;
        toggleQuantityInput();
    }

    // 3. ëª¨ë‹¬ ë‹«ê¸°
    function closeCouponModal() {
        document.getElementById('couponModal').style.display = 'none';
    }

    // 4. ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        const modal = document.getElementById('couponModal');
        if (event.target == modal) {
            closeCouponModal();
        }
    }
</script>

</body>
</html>