<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>ν¬μΈνΈ κ΄€λ¦¬ - Book2OnAndOn</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link rel="stylesheet" th:href="@{/css/pointHistoryAdmin.css}">
</head>
<body>
<th:block
        th:replace="~{fragments/layout :: commonHeader(${user} ?: ${session.user}, ${cartCount}, null, null, false)}"></th:block>

<div class="admin-container">
    <th:block th:replace="~{fragments/admin :: adminSidebar('points')}"></th:block>

    <main class="admin-content">
        <div class="admin-header">
            <div>
                <p class="eyebrow">ν¬μΈνΈ μ„Όν„°</p>
                <h2>μ‚¬μ©μ ν¬μΈνΈ κ΄€λ¦¬</h2>
            </div>
        </div>

        <div class="admin-toolbar">
            <label for="userIdInput">μ‚¬μ©μ ID</label>
            <form class="search-form" onsubmit="searchUser(event)" style="display:flex; gap:10px; width:100%;">
                <input
                        class="form-control"
                        id="userIdInput"
                        min="1"
                        placeholder="μ‚¬μ©μ IDλ¥Ό μ…λ ¥ν•μ„Έμ”"
                        required
                        style="max-width: 240px;" type="number">
                <button class="btn-primary" type="submit">μ΅°ν</button>
            </form>
        </div>

        <div id="pointInfoSection" style="display: none;">
            <div class="admin-detail-card">
                <div class="point-info">
                    <div>
                        <div class="point-label">μ‚¬μ©μ ID: <strong id="currentUserId"></strong></div>
                        <div class="point-label">ν„μ¬ λ³΄μ  ν¬μΈνΈ</div>
                    </div>
                    <div class="point-value" id="currentPoint">0 P</div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="openAdjustModal('EARN')">ν¬μΈνΈ μ§€κΈ‰</button>
                    <button class="btn btn-danger" onclick="openAdjustModal('USE')">ν¬μΈνΈ μ°¨κ°</button>
                    <button class="btn btn-secondary" onclick="expirePoints()">λ§λ£ ν¬μΈνΈ μ²λ¦¬</button>
                </div>
            </div>

            <div class="table-card history-table">
                <table class="admin-table">
                    <thead>
                    <tr>
                        <th>μΌμ‹</th>
                        <th>κµ¬λ¶„</th>
                        <th>ν¬μΈνΈ</th>
                        <th>μ”μ•΅</th>
                        <th>μ„¤λ…</th>
                        <th>λ§λ£μΌ</th>
                    </tr>
                    </thead>
                    <tbody id="historyTableBody">
                    <tr>
                        <td class="empty-state" colspan="6">
                            <div class="empty-state-icon">π“‹</div>
                            <div>ν¬μΈνΈ μ΄λ ¥μ΄ μ—†μµλ‹λ‹¤</div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="pagination" style="margin-top: 16px;"></div>
        </div>
    </main>
</div>

<!-- ν¬μΈνΈ μ΅°μ • λ¨λ‹¬ -->
<div class="modal-overlay" id="adjustModal">
    <div class="modal-card">
        <div class="modal-header">
            <h3 class="modal-title" id="adjustModalTitle">ν¬μΈνΈ μ§€κΈ‰/μ°¨κ°</h3>
            <button class="close-btn" onclick="closeAdjustModal()">&times;</button>
        </div>
        <form id="adjustForm" onsubmit="submitAdjust(event)">
            <div class="form-group">
                <label class="form-label">μ΅°μ • μ ν•</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input id="typeEarn" name="adjustType" required type="radio" value="EARN">
                        <label for="typeEarn">μ§€κΈ‰ (μ λ¦½)</label>
                    </div>
                    <div class="radio-option">
                        <input id="typeUse" name="adjustType" type="radio" value="USE">
                        <label for="typeUse">μ°¨κ° (μ‚¬μ©)</label>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">ν¬μΈνΈ</label>
                <input class="form-input" id="adjustPoint" min="1" required step="1" type="number">
                <div class="form-help">μ΅°μ •ν•  ν¬μΈνΈλ¥Ό μ…λ ¥ν•μ„Έμ”</div>
            </div>
            <div class="form-group">
                <label class="form-label">μ‚¬μ </label>
                <input class="form-input" id="adjustReason" maxlength="100" required type="text">
                <div class="form-help">ν¬μΈνΈ μ΅°μ • μ‚¬μ λ¥Ό μ…λ ¥ν•μ„Έμ”</div>
            </div>
            <div class="form-group" id="useTypeGroup" style="display:none;">
                <label class="form-label">μ°¨κ° μ ν•</label>
                <select class="form-input" id="useType">
                    <option value="USE">μ‚¬μ© μ°¨κ°</option>
                    <option value="CANCEL">μ·¨μ†/ν™λ¶ μ°¨κ°</option>
                </select>
                <div class="form-help">μ°¨κ° μ ν•μ„ μ„ νƒν•μ„Έμ”</div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeAdjustModal()" type="button">μ·¨μ†</button>
                <button class="btn btn-primary" type="submit">ν™•μΈ</button>
            </div>
        </form>
    </div>
</div>

<th:block th:replace="~{fragments/layout :: commonFooter}"></th:block>
<script src="/js/pointHistoryAdmin.js"></script>
</body>
</html>
